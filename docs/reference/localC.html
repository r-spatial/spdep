<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute Local Geary statistic — localC • spdep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute Local Geary statistic — localC"><meta name="description" content="The Local Geary is a local adaptation of Geary's C statistic of spatial autocorrelation. The Local Geary uses squared differences to measure dissimilarity unlike the Local Moran. Low values of the Local Geary indicate positive spatial autocorrelation and large refers to negative spatial autocorrelation.
Inference for the Local Geary is based on a permutation approach which compares the observed value to the reference distribution under spatial randomness. localC_perm() returns a pseudo p-value. This is not an analytical p-value and is based on the number of permutations and as such should be used with care."><meta property="og:description" content="The Local Geary is a local adaptation of Geary's C statistic of spatial autocorrelation. The Local Geary uses squared differences to measure dissimilarity unlike the Local Moran. Low values of the Local Geary indicate positive spatial autocorrelation and large refers to negative spatial autocorrelation.
Inference for the Local Geary is based on a permutation approach which compares the observed value to the reference distribution under spatial randomness. localC_perm() returns a pseudo p-value. This is not an analytical p-value and is based on the number of permutations and as such should be used with care."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a></li>
    <li><a class="dropdown-item" href="../articles/nb_sf.html">Creating Neighbours using sf objects</a></li>
    <li><a class="dropdown-item" href="../articles/nb.html">Creating Neighbours</a></li>
    <li><a class="dropdown-item" href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a></li>
    <li><a class="dropdown-item" href="../articles/subgraphs.html">No-neighbour observation and subgraph handling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/spdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Compute Local Geary statistic</h1>

      <div class="d-none name"><code>localC.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Local Geary is a local adaptation of Geary's C statistic of spatial autocorrelation. The Local Geary uses squared differences to measure dissimilarity unlike the Local Moran. Low values of the Local Geary indicate positive spatial autocorrelation and large refers to negative spatial autocorrelation.</p>
<p>Inference for the Local Geary is based on a permutation approach which compares the observed value to the reference distribution under spatial randomness. <code>localC_perm()</code> returns a pseudo p-value. This is not an analytical p-value and is based on the number of permutations and as such should be used with care.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">localC</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">listw</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'list'</span></span>
<span><span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'matrix'</span></span>
<span><span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'data.frame'</span></span>
<span><span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">localC_perm</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="cn">NULL</span>, iseed<span class="op">=</span><span class="cn">NULL</span>, no_repeat_in_row<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">localC_perm</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, nsim <span class="op">=</span> <span class="fl">499</span>, alternative <span class="op">=</span> <span class="st">"two.sided"</span>, <span class="va">...</span>,</span>
<span> zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span>, iseed<span class="op">=</span><span class="cn">NULL</span>, no_repeat_in_row<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'formula'</span></span>
<span><span class="fu">localC_perm</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, <span class="va">listw</span>, nsim <span class="op">=</span> <span class="fl">499</span>,</span>
<span> alternative <span class="op">=</span> <span class="st">"two.sided"</span>, <span class="va">...</span>, zero.policy<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">listw</span>, <span class="st">"zero.policy"</span><span class="op">)</span>, iseed<span class="op">=</span><span class="cn">NULL</span>,</span>
<span> no_repeat_in_row<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a numeric vector, numeric matrix, or list. See details for more.</p></dd>


<dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A one-sided formula determining which variables to be used.</p></dd>


<dt id="arg-listw">listw<a class="anchor" aria-label="anchor" href="#arg-listw"></a></dt>
<dd><p>a <code>listw</code> object created for example by <code>nb2listw</code>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Used when a formula is provided. A matrix or data frame containing the variables in the formula <code>formula</code>.</p></dd>


<dt id="arg-nsim">nsim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>The number of simulations to be used for permutation test.</p></dd>


<dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>A character defining the alternative hypothesis. Must be one of <code>"two.sided"</code>, <code>"less"</code> or <code>"greater"</code>.</p></dd>

<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other arguments passed to methods.</p></dd>

<dt id="arg-zero-policy">zero.policy<a class="anchor" aria-label="anchor" href="#arg-zero-policy"></a></dt>
<dd><p>default <code>attr(listw, "zero.policy")</code> as set when <code>listw</code> was created, if attribute not set, use global option value; if TRUE assign zero to the lagged value of zones without neighbours, if FALSE assign NA.</p></dd>

<dt id="arg-iseed">iseed<a class="anchor" aria-label="anchor" href="#arg-iseed"></a></dt>
<dd><p>default NULL, used to set the seed;the output will only be reproducible if the count of CPU cores across which computation is distributed is the same</p></dd>

<dt id="arg-no-repeat-in-row">no_repeat_in_row<a class="anchor" aria-label="anchor" href="#arg-no-repeat-in-row"></a></dt>
<dd><p>default <code>FALSE</code>, if <code>TRUE</code>, sample conditionally in each row without replacements to avoid duplicate values, <a href="https://github.com/r-spatial/spdep/issues/124" class="external-link">https://github.com/r-spatial/spdep/issues/124</a></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The Local Geary can be extended to a multivariate context. When <code>x</code> is a numeric vector, the univariate Local Geary will be calculated. To calculate the multivariate Local Moran provide either a list or a matrix. When <code>x</code> is a list, each element must be a numeric vector of the same length and of the same length as the neighbours in <code>listw</code>. In the case that <code>x</code> is a matrix the number of rows must be the same as the length of the neighbours in <code>listw</code>.</p>
<p>While not required in the univariate context, the standardized Local Geary is calculated. The multivariate Local Geary is <em>always</em> standardized.</p>
<p>The univariate Local Geary is calculated as \(c_i = \sum_j w_{ij}(x_i - x_j)^2\) and the multivariate Local Geary is calculated as \(c_{k,i} = \sum_{v=1}^{k} c_{v,i}\) as described in Anselin (2019).</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A numeric vector containing Local Geary statistic with attribute <code>pseudo-p</code> when <code>localC_perm()</code> is used. <code>pseudo-p</code> is an 8 column matrix containing</p>
<p></p>
<dl><dt>E.Ci</dt>
<dd><p>expectation of the Local Geary statistic based on permutation sample</p></dd>

  <dt>Var.Ci</dt>
<dd><p>variance of Local Geary based on permutation sample</p></dd>

  <dt>Z.Ci</dt>
<dd><p>standard deviate of Local Geary based on permutation sample</p></dd>

  <dt>Pr()</dt>
<dd><p>p-value of Local Geary statistic using <code><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">pnorm()</a></code> using standard deviates based on permutation sample means and standard deviations</p></dd>

  <dt>Pr() Sim</dt>
<dd><p><code><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank()</a></code> and <code><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">punif()</a></code> of observed statistic rank for [0, 1] p-values using <code>alternative=</code></p></dd>

  <dt>Pr(folded) Sim</dt>
<dd><p>the simulation folded [0, 0.5] range ranked p-value (based on <a href="https://github.com/pysal/esda/blob/4a63e0b5df1e754b17b5f1205b8cadcbecc5e061/esda/crand.py#L211-L213" class="external-link">https://github.com/pysal/esda/blob/4a63e0b5df1e754b17b5f1205b8cadcbecc5e061/esda/crand.py#L211-L213</a>)</p></dd>

  <dt>Skewness</dt>
<dd><p>the output of <code><a href="https://rdrr.io/pkg/e1071/man/skewness.html" class="external-link">e1071::skewness()</a></code> for the permutation samples underlying the standard deviates</p></dd>

  <dt>Kurtosis</dt>
<dd><p>the output of <code><a href="https://rdrr.io/pkg/e1071/man/kurtosis.html" class="external-link">e1071::kurtosis()</a></code> for the permutation samples underlying the standard deviates</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Anselin, L. (1995), Local Indicators of Spatial Association—LISA. Geographical Analysis, 27: 93-115. <a href="https://doi.org/10.1111/j.1538-4632.1995.tb00338.x" class="external-link">doi:10.1111/j.1538-4632.1995.tb00338.x</a></p>
<p>Anselin, L. (2019), A Local Indicator of Multivariate Spatial Association: Extending Gearys c. Geogr Anal, 51: 133-150. <a href="https://doi.org/10.1111/gean.12164" class="external-link">doi:10.1111/gean.12164</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Josiah Parry <a href="mailto:josiah.parry@gmail.com">josiah.parry@gmail.com</a> and Roger Bivand</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">orig</span> <span class="op">&lt;-</span> <span class="fu">spData</span><span class="fu">::</span><span class="va"><a href="https://jakubnowosad.com/spData/reference/afcon.html" class="external-link">africa.rook.nb</a></span></span></span>
<span class="r-in"><span><span class="va">listw</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">orig</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">spData</span><span class="fu">::</span><span class="va"><a href="https://jakubnowosad.com/spData/reference/afcon.html" class="external-link">afcon</a></span><span class="op">$</span><span class="va">totcon</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.39025457 0.50460439 0.15303047 2.90814878 3.40006901 0.17103368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] 0.29947832 0.72444806 2.30617282 5.70252541 2.23161263 0.17833029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] 0.18420002 0.18680408 0.37851643 0.11056720 0.14814835 0.17257920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] 0.03254150 0.18992772 0.08749322 3.71970760 0.09566918 0.26112918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] 0.09505331 2.99934478 1.17465032 1.64868780 0.87901004 0.05909537</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] 2.54591475 3.85570655 2.99413462 0.96084992 0.80678832 1.56869350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] 0.86422915 0.38817470 0.23425755 1.26191610 1.34455327 1.80707481</span>
<span class="r-in"><span><span class="va">listw1</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="fu"><a href="droplinks.html">droplinks</a></span><span class="op">(</span><span class="fu"><a href="testnb.html">sym.attr.nb</a></span><span class="op">(</span><span class="va">orig</span><span class="op">)</span>, <span class="fl">3</span>, sym<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>some observations have no neighbours</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 2 sub-graphs</span>
<span class="r-in"><span><span class="op">(</span><span class="va">A1</span> <span class="op">&lt;-</span> <span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw1</span>, zero.policy<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.39025457 0.57491918         NA 2.90814878 3.40006901 0.17103368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] 0.29947832 0.72444806 2.30617282 5.70252541 2.23161263 0.17833029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] 0.18420002 0.18680408 0.37851643 0.11056720 0.14814835 0.17257920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] 0.03254150 0.18992772 0.08749322 3.71970760 0.09566918 0.26112918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] 0.09505331 2.99934478 1.17465032 1.64868780 0.87901004 0.05909537</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] 2.54591475 3.85570655 2.99413462 0.96084992 0.80678832 1.56869350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] 0.86422915 0.38817470 0.23425755 1.26191610 1.34455327 1.80707481</span>
<span class="r-in"><span><span class="op">(</span><span class="va">A2</span> <span class="op">&lt;-</span> <span class="fu">localC</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw1</span>, zero.policy<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.39025457 0.57491918 0.00000000 2.90814878 3.40006901 0.17103368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7] 0.29947832 0.72444806 2.30617282 5.70252541 2.23161263 0.17833029</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] 0.18420002 0.18680408 0.37851643 0.11056720 0.14814835 0.17257920</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19] 0.03254150 0.18992772 0.08749322 3.71970760 0.09566918 0.26112918</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] 0.09505331 2.99934478 1.17465032 1.64868780 0.87901004 0.05909537</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [31] 2.54591475 3.85570655 2.99413462 0.96084992 0.80678832 1.56869350</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] 0.86422915 0.38817470 0.23425755 1.26191610 1.34455327 1.80707481</span>
<span class="r-in"><span><span class="va">run</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/geodacenter/rgeoda/" class="external-link">rgeoda</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="va">run</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘rgeoda’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following object is masked from ‘package:spdep’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     skater</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/create_weights.html" class="external-link">create_weights</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">listw</span><span class="op">$</span><span class="va">neighbours</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/set_neighbors_with_weights.html" class="external-link">set_neighbors_with_weights</a></span><span class="op">(</span><span class="va">W</span>, <span class="va">i</span>, <span class="va">listw</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>, <span class="va">listw</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/update_weights.html" class="external-link">update_weights</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_geary.html" class="external-link">local_geary</a></span><span class="op">(</span><span class="va">W</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">A</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_values.html" class="external-link">lisa_values</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">C</span> <span class="op">&lt;-</span> <span class="fu">localC_perm</span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, nsim <span class="op">=</span> <span class="fl">499</span>, conditional<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.5</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span>, <span class="fl">1</span><span class="op">-</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">B</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">C</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.985611</span>
<span class="r-in"><span><span class="co"># pseudo-p values probably wrongly folded https://github.com/GeoDaCenter/rgeoda/issues/28</span></span></span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="va">tmap_ok</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-tmap.github.io/tmap/" class="external-link">tmap</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="va">tmap_ok</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Breaking News: tmap 3.x is retiring. Please test v4, e.g. with</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> remotes::install_github('r-tmap/tmap')</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co"># doi: 10.1111/gean.12164</span></span></span>
<span class="r-in"><span>  <span class="va">guerry_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Guerry.shp"</span>, package <span class="op">=</span> <span class="st">"rgeoda"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">guerry_path</span><span class="op">)</span><span class="op">[</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span> <span class="co">#(Tab. 1)</span></span></span>
<span class="r-in"><span>  <span class="va">lw</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="fu"><a href="poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="moran.html">moran</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">Crm_prs</span>, <span class="va">lw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="moran.html">moran</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">Crm_prp</span>, <span class="va">lw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="moran.html">moran</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">Litercy</span>, <span class="va">lw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="moran.html">moran</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">Donatns</span>, <span class="va">lw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="moran.html">moran</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">Infants</span>, <span class="va">lw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="moran.html">moran</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">Suicids</span>, <span class="va">lw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">I</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reading layer `Guerry' from data source </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `/home/rsb/lib/r_libs/rgeoda/extdata/Guerry.shp' using driver `ESRI Shapefile'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 85 features and 29 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: MULTIPOLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: 47680 ymin: 1703258 xmax: 1031401 ymax: 2677441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Projected CRS: NTF (Paris) / Lambert zone II</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4016812</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, scale.<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>, <span class="va">o</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="co">#(Tab. 2)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 PC1         PC2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Crm_prs 0.009286863 0.418851254</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Crm_prp 0.561825664 0.009377232</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Litercy 0.560570048 0.020095011</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Donatns 0.024138865 0.586720363</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Infants 0.436025658 0.012817054</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Suicids 0.548623327 0.152958961</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">PC1</span> <span class="op">&lt;-</span> <span class="va">o</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="st">"PC1"</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">brks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span><span class="op">)</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/natural_breaks.html" class="external-link">natural_breaks</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">6</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">tmap4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"tmap"</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"3.99"</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"PC1"</span>, </span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.rd_yl_gn"</span>, breaks<span class="op">=</span><span class="va">brks</span>,</span></span>
<span class="r-in"><span>        midpoint<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"PC1"</span>, breaks<span class="op">=</span><span class="va">brks</span>, midpoint<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 1</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu">pplot</span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span>, breaks<span class="op">=</span><span class="va">brks</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">PC2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span><span class="op">*</span><span class="va">o</span><span class="op">$</span><span class="va">x</span><span class="op">[</span>, <span class="st">"PC2"</span><span class="op">]</span> <span class="co"># eigenvalue sign arbitrary</span></span></span>
<span class="r-in"><span>  <span class="va">brks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC2</span><span class="op">)</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/natural_breaks.html" class="external-link">natural_breaks</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">6</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC2"</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"PC2"</span>, </span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.rd_yl_gn"</span>, breaks<span class="op">=</span><span class="va">brks</span>,</span></span>
<span class="r-in"><span>        midpoint<span class="op">=</span><span class="fl">0</span><span class="op">)</span>, fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"PC2"</span>, breaks<span class="op">=</span><span class="va">brks</span>, midpoint<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> </span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 2</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"PC2"</span><span class="op">]</span>, breaks<span class="op">=</span><span class="va">brks</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/queen_weights.html" class="external-link">queen_weights</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lm_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_moran.html" class="external-link">local_moran</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lm_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lm_PC1</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lm_PC1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lm_PC1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lm_PC1</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lm_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lm_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lm_PC1"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lm_PC1"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 3</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lm_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lm_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="localmoran.html">localmoran_perm</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span>, <span class="va">lw</span>, nsim<span class="op">=</span><span class="fl">9999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lm_PC1_spdep</span>, <span class="st">"quadr"</span><span class="op">)</span><span class="op">$</span><span class="va">pysal</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lm_PC1_spdep</span> <span class="op">&lt;-</span> <span class="va">q</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lm_PC1_spdep</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">lm_PC1_spdep</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0.02</span> <span class="co"># note folded p-values</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lm_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lm_PC1_spdep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lm_PC1_spdep"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lm_PC1_spdep"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># rep. Fig. 3</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lm_PC1_spdep"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lg_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_g.html" class="external-link">local_g</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lg_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lg_PC1</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lg_PC1</span><span class="op">)</span><span class="op">[</span><span class="fl">0</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lg_PC1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lg_PC1</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lg_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lg_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lg_PC1"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lg_PC1"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 4 (wrong)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lg_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lg_PC1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span>, labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Low"</span>, <span class="st">"High"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lg_PC1a</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">lg_PC1</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lg_PC1a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lg_PC1a</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lg_PC1a"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lg_PC1a"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 4 (guess)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lg_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lc_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_geary.html" class="external-link">local_geary</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lc_PC1</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lc_PC1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lc_PC1</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc_PC1"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc_PC1"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 5</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-6.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu">localC_perm</span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span>, <span class="va">lw</span>, nsim<span class="op">=</span><span class="fl">9999</span>,</span></span>
<span class="r-in"><span>    alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.340   0.001   0.343 </span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">parallel</span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">ncpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span>logical<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">-</span><span class="fl">1L</span></span></span>
<span class="r-in"><span><span class="co"># test with single core</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">ncpus</span> <span class="op">&gt;</span> <span class="fl">1L</span><span class="op">)</span> <span class="va">ncpus</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="va">cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="set.mcOption.html">get.coresOption</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="set.mcOption.html">set.coresOption</a></span><span class="op">(</span><span class="va">ncpus</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">lmc_PC1_spdep1</span> <span class="op">&lt;-</span> <span class="fu">localC_perm</span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">PC1</span>, <span class="va">lw</span>, nsim<span class="op">=</span><span class="fl">9999</span>,</span></span>
<span class="r-in"><span>      alternative<span class="op">=</span><span class="st">"two.sided"</span>, iseed<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="set.mcOption.html">set.coresOption</a></span><span class="op">(</span><span class="va">cores</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span>, <span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC1_spdep</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC1_spdep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc_PC1_spdep"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc_PC1_spdep"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># rep. Fig. 5</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc_PC1_spdep"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-7.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">both_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC1</span>, <span class="va">g</span><span class="op">$</span><span class="va">lm_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">both_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">both_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"both_PC1"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"both_PC1"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 6</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"both_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-8.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lc005_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_geary.html" class="external-link">local_geary</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.005</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lc005_PC1</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lc005_PC1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc005_PC1"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc005_PC1"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 7</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc005_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span>, <span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1_spdep</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0.005</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc005_PC1_spdep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc005_PC1_spdep"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc005_PC1_spdep"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># rep. Fig. 7</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc005_PC1_spdep"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lc001_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_geary.html" class="external-link">local_geary</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC1"</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.001</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lc001_PC1</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lc001_PC1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc005_PC1"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc001_PC1"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 8</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc001_PC1"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span>, <span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1_spdep</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lc_PC1_spdep</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span> <span class="op">&gt;</span> <span class="fl">0.001</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc001_PC1_spdep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc005_PC1_spdep"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc001_PC1_spdep"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># rep. Fig. 8</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc001_PC1_spdep"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-9.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lc_PC2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_geary.html" class="external-link">local_geary</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="st">"PC2"</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.01</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc_PC2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lc_PC2</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lc_PC2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lc_PC2</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lc_PC2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lc_PC2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lc_PC2"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lc_PC2"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 9</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lc_PC2"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-10.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lmc_PC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_multigeary.html" class="external-link">local_multigeary</a></span><span class="op">(</span><span class="va">w</span>, <span class="va">g</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>,<span class="st">"PC2"</span><span class="op">)</span><span class="op">]</span>, significance_cutoff<span class="op">=</span><span class="fl">0.00247</span>,</span></span>
<span class="r-in"><span>    permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_PC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lmc_PC</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lmc_PC</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_PC</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lmc_PC</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_PC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_PC</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">lmc_PC</span><span class="op">)</span>, <span class="st">"fdr"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span>, <span class="va">g</span><span class="op">$</span><span class="va">lmc_PC</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE.Positive  TRUE.Positive </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              0             21 </span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lmc_PC"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lmc_PC"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 10</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lmc_PC"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-11.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">lmc_PC_spdep</span> <span class="op">&lt;-</span> <span class="fu">localC_perm</span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>,<span class="st">"PC2"</span><span class="op">)</span><span class="op">]</span>, <span class="va">lw</span>, nsim<span class="op">=</span><span class="fl">9999</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_values.html" class="external-link">lisa_values</a></span><span class="op">(</span><span class="va">lmc_PC</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lmc_PC_spdep</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_PC_spdep</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">lmc_PC</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9905202</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_PC_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_PC_spdep</span>, <span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_PC_spdep</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_PC_spdep</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span>, <span class="st">"fdr"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_PC_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_PC_spdep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lmc_PC_spdep"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lmc_PC_spdep"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># rep. Fig. 10</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lmc_PC_spdep"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-12.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">lmc_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/local_multigeary.html" class="external-link">local_multigeary</a></span><span class="op">(</span><span class="va">w</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    significance_cutoff<span class="op">=</span><span class="fl">0.00247</span>, permutations<span class="op">=</span><span class="fl">99999</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_clusters.html" class="external-link">lisa_clusters</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span>, levels<span class="op">=</span><span class="fl">0</span><span class="op">:</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>    labels<span class="op">=</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_labels.html" class="external-link">lisa_labels</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_vars</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">g</span><span class="op">$</span><span class="va">lmc_vars</span> <span class="op">==</span> <span class="st">"Not significant"</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_vars</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span>, <span class="st">"fdr"</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    <span class="va">g</span><span class="op">$</span><span class="va">lmc_vars</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> FALSE.Positive  TRUE.Positive </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              0             21 </span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lmc_vars"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lmc_vars"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Fig. 11</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lmc_vars"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-13.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">lmc_vars_spdep</span> <span class="op">&lt;-</span> <span class="fu">localC_perm</span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="va">lw</span>,</span></span>
<span class="r-in"><span>    nsim<span class="op">=</span><span class="fl">9999</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.559   0.014   0.575 </span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_values.html" class="external-link">lisa_values</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lmc_vars_spdep</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_vars_spdep</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9938141</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">parallel</span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="va">ncpus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span>logical<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">-</span><span class="fl">1L</span></span></span>
<span class="r-in"><span><span class="co"># test with single core</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">ncpus</span> <span class="op">&gt;</span> <span class="fl">1L</span><span class="op">)</span> <span class="va">ncpus</span> <span class="op">&lt;-</span> <span class="fl">1L</span></span></span>
<span class="r-in"><span>    <span class="va">cores</span> <span class="op">&lt;-</span> <span class="fu"><a href="set.mcOption.html">get.coresOption</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="set.mcOption.html">set.coresOption</a></span><span class="op">(</span><span class="va">ncpus</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">lmc_vars_spdep1</span> <span class="op">&lt;-</span> <span class="fu">localC_perm</span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span>, <span class="va">lw</span>,</span></span>
<span class="r-in"><span>      nsim<span class="op">=</span><span class="fl">9999</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span>, iseed<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="set.mcOption.html">set.coresOption</a></span><span class="op">(</span><span class="va">cores</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_values.html" class="external-link">lisa_values</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lmc_vars_spdep1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_vars_spdep1</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span>, <span class="fu"><a href="https://geodacenter.github.io/rgeoda/reference/lisa_pvalues.html" class="external-link">lisa_pvalues</a></span><span class="op">(</span><span class="va">lmc_vars</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9938141</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="va">run</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_vars_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_vars_spdep1</span>, <span class="st">"cluster"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_vars_spdep</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/p.adjust.html" class="external-link">p.adjust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lmc_vars_spdep1</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span>, <span class="st">"fdr"</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0.01</span></span></span>
<span class="r-in"><span>  <span class="va">g</span><span class="op">$</span><span class="va">lmc_vars_spdep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/droplevels.html" class="external-link">droplevels</a></span><span class="op">(</span><span class="va">g</span><span class="op">$</span><span class="va">lmc_vars_spdep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmap_ok</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="kw">if</span> <span class="op">(</span><span class="va">tmap4</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_polygons</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"lmc_vars_spdep"</span>,</span></span>
<span class="r-in"><span>        fill.scale<span class="op">=</span><span class="fu">tm_scale</span><span class="op">(</span>values<span class="op">=</span><span class="st">"brewer.set3"</span>, value.na<span class="op">=</span><span class="st">"gray95"</span>,</span></span>
<span class="r-in"><span>          label.na<span class="op">=</span><span class="st">"Insignificant"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>        fill.legend<span class="op">=</span><span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_legend</a></span><span class="op">(</span>position<span class="op">=</span><span class="fu">tm_pos_in</span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          frame<span class="op">=</span><span class="cn">FALSE</span>, item.r<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>      <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_fill</a></span><span class="op">(</span><span class="st">"lmc_vars_spdep"</span>, textNA<span class="op">=</span><span class="st">"Insignificant"</span>,</span></span>
<span class="r-in"><span>        colorNA<span class="op">=</span><span class="st">"gray95"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># rep. Fig. 11</span></span></span>
<span class="r-in"><span>    <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g</span><span class="op">[</span><span class="st">"lmc_vars_spdep"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="localC-14.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/reticulate/" class="external-link">reticulate</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rstudio.github.io/reticulate/reference/use_python.html" class="external-link">use_python</a></span><span class="op">(</span><span class="st">"/usr/bin/python"</span>, required <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"geopandas"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in py_module_import(module, convert = convert):</span> ModuleNotFoundError: No module named 'geopandas'</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> Run `reticulate::py_last_error()` for details.</span>
<span class="r-in"><span><span class="va">ps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"libpysal"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in py_module_import(module, convert = convert):</span> ModuleNotFoundError: No module named 'libpysal'</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> Run `reticulate::py_last_error()` for details.</span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2mat.html">listw2mat</a></span><span class="op">(</span><span class="va">listw</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">ps</span><span class="op">$</span><span class="va">weights</span><span class="op">$</span><span class="fu">full2W</span><span class="op">(</span><span class="va">W</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'ps' not found</span>
<span class="r-in"><span><span class="va">w</span><span class="op">$</span><span class="va">transform</span> <span class="op">&lt;-</span> <span class="st">"R"</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in envRefSetField(x, what, refObjectClass(x), selfEnv, value):</span> ‘transform’ is not a field in class “Weight”</span>
<span class="r-in"><span><span class="va">esda</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rstudio.github.io/reticulate/reference/import.html" class="external-link">import</a></span><span class="op">(</span><span class="st">"esda"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in py_module_import(module, convert = convert):</span> ModuleNotFoundError: No module named 'esda'</span>
<span class="r-err co"><span class="r-pr">#&gt;</span> Run `reticulate::py_last_error()` for details.</span>
<span class="r-in"><span><span class="va">lM</span> <span class="op">&lt;-</span> <span class="va">esda</span><span class="op">$</span><span class="fu">Moran_Local</span><span class="op">(</span><span class="va">x</span>, <span class="va">w</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'esda' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="fu"><a href="localmoran.html">localmoran</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">listw</span>, mlvar<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lM</span><span class="op">$</span><span class="va">Is</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'current' in selecting a method for function 'all.equal': object 'lM' not found</span>
<span class="r-in"><span><span class="co"># confirm x and w the same</span></span></span>
<span class="r-in"><span><span class="va">lC</span> <span class="op">&lt;-</span> <span class="va">esda</span><span class="op">$</span><span class="fu">Geary_Local</span><span class="op">(</span>connectivity<span class="op">=</span><span class="va">w</span><span class="op">)</span><span class="op">$</span><span class="fu">fit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'esda' not found</span>
<span class="r-in"><span><span class="co"># np$std missing ddof=1</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">D0</span> <span class="op">&lt;-</span> <span class="fu">spdep</span><span class="fu">:::</span><span class="fu">geary.intern</span><span class="op">(</span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">var</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="va">n</span><span class="op">)</span>, <span class="va">listw</span>, n<span class="op">=</span><span class="va">n</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># lC components probably wrongly ordered https://github.com/pysal/esda/issues/192</span></span></span>
<span class="r-in"><span><span class="va">o</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/match.html" class="external-link">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">D0</span>, <span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">lC</span><span class="op">$</span><span class="va">localG</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lC' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lC</span><span class="op">$</span><span class="va">localG</span><span class="op">)</span><span class="op">[</span><span class="va">o</span><span class="op">]</span>, <span class="va">D0</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'target' in selecting a method for function 'all.equal': object 'lC' not found</span>
<span class="r-in"><span><span class="co"># simulation order not retained</span></span></span>
<span class="r-in"><span><span class="va">lC</span><span class="op">$</span><span class="va">p_sim</span><span class="op">[</span><span class="va">o</span><span class="op">]</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'lC' not found</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">C</span>, <span class="st">"pseudo-p"</span><span class="op">)</span><span class="op">[</span>,<span class="fl">6</span><span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 0.408 0.374 0.144 0.056 0.010 0.284 0.032 0.264 0.186 0.004 0.150 0.224</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] 0.022 0.150 0.438 0.084 0.126 0.184 0.002 0.238 0.126 0.100 0.068 0.372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] 0.124 0.234 0.230 0.016 0.318 0.176 0.272 0.164 0.164 0.206 0.402 0.250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [37] 0.410 0.402 0.328 0.294 0.438 0.248</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

