<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Weighted Multivariate Spatial Autocorrelation Measures — spatialdelta • spdep</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Weighted Multivariate Spatial Autocorrelation Measures — spatialdelta"><meta name="description" content="The kernel-based weighted multivariate spatial autocorrelation measure delta proposed in Bavaud (2024) is implemented, together with support functions to create spatial weights matrices from symmetric binary adjacency matrices; summary and display methods are provided."><meta property="og:description" content="The kernel-based weighted multivariate spatial autocorrelation measure delta proposed in Bavaud (2024) is implemented, together with support functions to create spatial weights matrices from symmetric binary adjacency matrices; summary and display methods are provided."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a></li>
    <li><a class="dropdown-item" href="../articles/nb_sf.html">Creating Neighbours using sf objects</a></li>
    <li><a class="dropdown-item" href="../articles/nb.html">Creating Neighbours</a></li>
    <li><a class="dropdown-item" href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a></li>
    <li><a class="dropdown-item" href="../articles/subgraphs.html">No-neighbour observation and subgraph handling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/spdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Weighted Multivariate Spatial Autocorrelation Measures</h1>

      <div class="d-none name"><code>spatialdelta.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The kernel-based weighted multivariate spatial autocorrelation measure delta proposed in Bavaud (2024) is implemented, together with support functions to create spatial weights matrices from symmetric binary adjacency matrices; summary and display methods are provided.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spatialdelta</span><span class="op">(</span><span class="va">dissimilarity_matrix</span>, <span class="va">adjusted_spatial_weights</span>,</span>
<span> regional_weights<span class="op">=</span><span class="cn">NULL</span>, alternative <span class="op">=</span> <span class="st">"greater"</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'summary.spatialdelta'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"digits"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">linearised_diffusive_weights</span><span class="op">(</span><span class="va">adjacency_matrix</span>, <span class="va">regional_weights</span>, t_choice <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">metropolis_hastings_weights</span><span class="op">(</span><span class="va">adjacency_matrix</span>, <span class="va">regional_weights</span><span class="op">)</span></span>
<span><span class="fu">iterative_proportional_fitting_weights</span><span class="op">(</span><span class="va">adjacency_matrix</span>, <span class="va">regional_weights</span>,</span>
<span> g<span class="op">=</span><span class="fl">0.001</span>, iter<span class="op">=</span><span class="fl">1000</span>, tol<span class="op">=</span><span class="fl">1e-10</span>, tol.margins<span class="op">=</span><span class="fl">1e-10</span>, print<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">graph_distance_weights</span><span class="op">(</span><span class="va">adjacency_matrix</span>, <span class="va">regional_weights</span>, c<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'adjusted_spatial_weights'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">x</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>,</span>
<span> mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, power <span class="op">=</span> <span class="fl">1L</span>, fmult <span class="op">=</span> <span class="cn">NULL</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"rnames"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="fl">1</span>,</span>
<span> pos <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.6</span>, largest <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">plot_moran</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">plot_moran</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">plot_moran</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, fmult <span class="op">=</span> <span class="cn">NULL</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"rnames"</span><span class="op">)</span>,</span>
<span> bg <span class="op">=</span> <span class="fl">1</span>, pos <span class="op">=</span> <span class="fl">3</span>, cex <span class="op">=</span> <span class="fl">0.6</span>, largest <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">x</span>, lwd<span class="op">=</span><span class="fl">2</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">factorial_coordinates</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">factorial_coordinates</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">factorial_coordinates</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="fu">plot_factorialcoords</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">plot_factorialcoords</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">plot_factorialcoords</span><span class="op">(</span><span class="va">x</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>,</span>
<span> mult <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, fmult <span class="op">=</span> <span class="cn">NULL</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"rnames"</span><span class="op">)</span>, bg <span class="op">=</span> <span class="fl">1</span>, pos <span class="op">=</span> <span class="fl">3</span>,</span>
<span> cex <span class="op">=</span> <span class="fl">0.6</span>, largest <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">plot_factorialscree</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">plot_factorialscree</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">plot_factorialscree</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">localdelta</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">localdelta</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">localdelta</span><span class="op">(</span><span class="va">x</span>, names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"rnames"</span><span class="op">)</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">cornish_fisher</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># Default S3 method</span></span>
<span><span class="fu">cornish_fisher</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'spatialdelta'</span></span>
<span><span class="fu">cornish_fisher</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-dissimilarity-matrix">dissimilarity_matrix<a class="anchor" aria-label="anchor" href="#arg-dissimilarity-matrix"></a></dt>
<dd><p><code>dissimilarity_matrix</code> is a square matrix of dissimilarities between (possibly multivariate) observations</p></dd>

  <dt id="arg-adjusted-spatial-weights">adjusted_spatial_weights<a class="anchor" aria-label="anchor" href="#arg-adjusted-spatial-weights"></a></dt>
<dd><p><code>adjusted_spatial_weights</code> is a square matrix of spatial weights as returned by construction functions <code>linearised_diffusive_weights</code>, <code>metropolis_hastings_weights</code>, <code>iterative_proportional_fitting_weights</code>, <code>graph_distance_weights</code> or similar; only the named construction functions pass regional_weights through to <code>spatialdelta</code>, so for matrices constructed in other ways, this argument is required</p></dd>

  <dt id="arg-regional-weights">regional_weights<a class="anchor" aria-label="anchor" href="#arg-regional-weights"></a></dt>
<dd><p>default NULL, <code>regional_weights</code> are weights reflecting the contribution of each observation to the (possibly multivariate) data set, they may be uniform, but none can be zero, and they must sum to unity; if <code>adjusted_spatial_weights</code> is an <code>"adjusted_spatial_weights"</code> object created by <code>linearised_diffusive_weights</code>, <code>metropolis_hastings_weights</code>, <code>iterative_proportional_fitting_weights</code> or <code>graph_distance_weights</code>, <code>regional_weights</code> is passed as an attribute</p></dd>

  <dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>a character string specifying the alternative hypothesis, must be one of "greater" (default), "less" or "two.sided"</p></dd>

  <dt id="arg-object-x">object, x<a class="anchor" aria-label="anchor" href="#arg-object-x"></a></dt>
<dd><p><code>object</code>, <code>x</code> are objects returned by <code>spatialdelta</code> of class <code>"spatialdelta"</code>, or of class <code>"adjusted_spatial_weights"</code></p></dd>

  <dt id="arg-digits">digits<a class="anchor" aria-label="anchor" href="#arg-digits"></a></dt>
<dd><p>default <code>getOption("digits")</code>, or a non-null value specifying the minimum number of significant digits to be printed in values</p></dd>

  <dt id="arg-adjacency-matrix">adjacency_matrix<a class="anchor" aria-label="anchor" href="#arg-adjacency-matrix"></a></dt>
<dd><p><code>adjacency_matrix</code> is a symmetric binary adjacency matrix</p></dd>

  <dt id="arg-t-choice">t_choice<a class="anchor" aria-label="anchor" href="#arg-t-choice"></a></dt>
<dd><p>default 2, the inverse of the largest eigenvalue of the adjusted Laplacian adjacency matrix (t2, Bavaud 2024, page 583), otherwise 1 (t1, page 579)</p></dd>

  <dt id="arg-g">g<a class="anchor" aria-label="anchor" href="#arg-g"></a></dt>
<dd><p>default 0.001, (Bavaud 2024, page 579, 589), a small quantity to lift binary adjacency matrix above zero</p></dd>

  <dt id="arg-iter-tol-tol-margins-print">iter, tol, tol.margins, print<a class="anchor" aria-label="anchor" href="#arg-iter-tol-tol-margins-print"></a></dt>
<dd><p>arguments passed to <code><a href="https://rdrr.io/pkg/mipfp/man/Ipfp.html" class="external-link">Ipfp</a></code></p></dd>

  <dt id="arg-c">c<a class="anchor" aria-label="anchor" href="#arg-c"></a></dt>
<dd><p>default NULL, a coefficient greater than zero and less than or equal to -1/min(B) where B is the matrix of scalar products associated with the distance matrix; if not given, -1/min(B) is used</p></dd>

  <dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>a numeric vector from which to create a Moran plot</p></dd>

  <dt id="arg-cols">cols<a class="anchor" aria-label="anchor" href="#arg-cols"></a></dt>
<dd><p>integer vector of length 2, default <code>c(1L, 2L)</code>, giving the two columns of the regional or factorial coordinates to plot</p></dd>

  <dt id="arg-mult">mult<a class="anchor" aria-label="anchor" href="#arg-mult"></a></dt>
<dd><p>numeric vector of length 2, default <code>c(1, 1)</code>, to scale or reverse axes as signs are not given to be the same for different eigenproblem implementations</p></dd>

  <dt id="arg-power">power<a class="anchor" aria-label="anchor" href="#arg-power"></a></dt>
<dd><p>integer vector of length 1, default 1; if higher, use a powered kernel</p></dd>

  <dt id="arg-fmult">fmult<a class="anchor" aria-label="anchor" href="#arg-fmult"></a></dt>
<dd><p>default <code>NULL</code> for automatic scaling of the circle symbols expressing the observation weights <code>f</code> in the plot as <code>(0.02*diff(range(X)))/diff(range(regional_weights))</code> where <code>X</code> is the first vector of coordinates; may be set manually to a numeric value</p></dd>

  <dt id="arg-names">names<a class="anchor" aria-label="anchor" href="#arg-names"></a></dt>
<dd><p>default <code>attr(x, "rnames")</code>, the coordinates will be annotated with these strings passed through from the <code>"region.id"</code> attribute of the <code>"nb"</code> object used to create the <code>adjusted_spatial_weights</code> matrix from the <code>"adjacency_matrix"</code> object as row and column names</p></dd>

  <dt id="arg-bg-pos-cex-lwd">bg, pos, cex, lwd<a class="anchor" aria-label="anchor" href="#arg-bg-pos-cex-lwd"></a></dt>
<dd><p>arguments passed to graphics functions or methods</p></dd>

  <dt id="arg-largest">largest<a class="anchor" aria-label="anchor" href="#arg-largest"></a></dt>
<dd><p>default NULL, may be integer &gt; 0 and &lt;= the region count, permitting names to be plotted only for the <code>largest</code> circle symbols</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>other arguments passed to other functions or methods</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>In general, the user should choose one of the functions for constructing spatial weights from the symmetric binary, or similar to symmetric - for example row-standardised - adjacency matrix. The <code>cornish_fisher</code> method updates the standard deviate and p-value if the pair of skewness and excess kurtosis estimates are within the required domain.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>spatialdelta</code> returns an object with classes <code>"spatialdelta"</code> and <code>"htest"</code>. Its <code>print</code> method treats it as an <code>"htest"</code> object. Other methods use additional attributes:</p>
<dl><dt>Kx</dt>
<dd><p>Multivariate kernel matrix eq. 16</p></dd>

  <dt>Kw</dt>
<dd><p>Spatial weights kernel matrix eq. 21</p></dd>

  <dt>regional_weights</dt>
<dd><p>Input observation weights</p></dd>

  <dt>adjusted_spatial_weights</dt>
<dd><p>Input spatial adjusted_spatial_weightseights</p></dd>

  <dt>B</dt>
<dd><p>symmetric matrix of scalar products eq. 15</p></dd>

  <dt>VI</dt>
<dd><p>Spatial component of delta variance</p></dd>

  <dt>Vx</dt>
<dd><p>Multivariate component of delta variance</p></dd>

  <dt>Vd0</dt>
<dd><p>Variance of delta calculated in another way eq. 38</p></dd>

  <dt>alphamu</dt>
<dd><p>Spatial component of delta skewness</p></dd>

  <dt>alphalambda</dt>
<dd><p>Multivariate component of delta skewness</p></dd>

  <dt>gammamu</dt>
<dd><p>Spatial component of delta excess kurtosis</p></dd>

  <dt>gammalambda</dt>
<dd><p>Multivariate component of delta excess kurtosis</p></dd>

  <dt>rnames</dt>
<dd><p>Region names passed through from row/column names of <code>adjusted_spatial_weights</code>, from the <code>"region.id"</code> attribute of the <code>"nb"</code> object used to create the <code>adjusted_spatial_weights</code> matrix from the <code>"adjacency_matrix"</code> object</p></dd>

</dl><p><code>linearised_diffusive_weights</code>, <code>metropolis_hastings_weights</code>, <code>iterative_proportional_fitting_weights</code> and <code>graph_distance_weights</code> return square spatial weights matrices (the latter two return matrices created by <code>metropolis_hastings_weights</code> if <span class="pkg">igraph</span> or <span class="pkg">mipfp</span> are not available); <code>factorial_coordinates</code> returns a square factorial matrix; <code>localdelta</code> returns a vector of local deltas eq. 30.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bavaud, F. (2024), Measuring and Testing Multivariate Spatial Autocorrelation in a Weighted Setting: A Kernel Approach. Geographical Analysis, 56: 573-599. <a href="https://doi.org/10.1111/gean.12390" class="external-link">doi:10.1111/gean.12390</a>
; Bivand, R. (2025) Implementing a weighted measure of multivariate spatial autocorrelation, Cahiers Du Centre De Linguistique Et Des Sciences Du Langage, (69), 19-35, <a href="https://doi.org/10.26034/la.cdclsl.2025.8343" class="external-link">doi:10.26034/la.cdclsl.2025.8343</a></p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Roger Bivand, <a href="mailto:Roger.Bivand@nhh.no">Roger.Bivand@nhh.no</a></p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>The input adjacency matrix should be symmetric, and not have sub-graphs or islands - it should be possible to step across graph edges from any observation to any other.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/mipfp/man/Ipfp.html" class="external-link">Ipfp</a></code>, <code><a href="https://r.igraph.org/reference/distances.html" class="external-link">distances</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">toy_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_xa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">9</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_nba</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2L</span>, <span class="fl">3L</span>, <span class="fl">4L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">4L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">3L</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> class<span class="op">=</span><span class="st">"nb"</span>, region.id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_gla</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.25</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_wa</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2mat.html">nb2mat</a></span><span class="op">(</span><span class="va">toy_nba</span>, glist<span class="op">=</span><span class="va">toy_gla</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">toy_xa</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span> adjusted_spatial_weights<span class="op">=</span><span class="va">toy_wa</span>, regional_weights<span class="op">=</span><span class="va">toy_f</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Bavaud delta normal approximation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  as.matrix(dist(toy_xa))^2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> weights: toy_wa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard deviate = 1.9799, p-value = 0.04771</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two.sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           delta     Expectation        Variance        Skewness Excess Kurtosis </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0.13333333     -0.33333333      0.05555556      0.16162441             Inf </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">toy_xb</span> <span class="op">&lt;-</span> <span class="va">toy_xa</span></span></span>
<span class="r-in"><span><span class="va">toy_glb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.125</span>, <span class="fl">0.25</span>, <span class="fl">0.125</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">3</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">6</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_nbb</span> <span class="op">&lt;-</span> <span class="fu"><a href="include.self.html">include.self</a></span><span class="op">(</span><span class="va">toy_nba</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_wb</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2mat.html">nb2mat</a></span><span class="op">(</span><span class="va">toy_nbb</span>, glist<span class="op">=</span><span class="va">toy_glb</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">toy_xb</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span> adjusted_spatial_weights<span class="op">=</span><span class="va">toy_wb</span>, regional_weights<span class="op">=</span><span class="va">toy_f</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Bavaud delta normal approximation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  as.matrix(dist(toy_xb))^2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> weights: toy_wb</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard deviate = 1.9799, p-value = 0.04771</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two.sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           delta     Expectation        Variance        Skewness Excess Kurtosis </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0.56666667      0.33333333      0.01388889      0.16162441             Inf </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">toy_xc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_nbc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">4L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3L</span>, <span class="fl">4L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">2L</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> class<span class="op">=</span><span class="st">"nb"</span>, region.id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_glc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.4</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">toy_wc</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2mat.html">nb2mat</a></span><span class="op">(</span><span class="va">toy_nbc</span>, glist<span class="op">=</span><span class="va">toy_glc</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">toy_xc</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span> adjusted_spatial_weights<span class="op">=</span><span class="va">toy_wc</span>, regional_weights<span class="op">=</span><span class="va">toy_f</span>, alternative<span class="op">=</span><span class="st">"two.sided"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Bavaud delta normal approximation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  as.matrix(dist(toy_xc))^2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> weights: toy_wc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Standard deviate = -2.2361, p-value = 0.02535</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: two.sided</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           delta     Expectation        Variance        Skewness Excess Kurtosis </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -1.00000000     -0.33333333      0.08888889     -0.63887656             Inf </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/friendly/Guerry" class="external-link">Guerry</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">gfrance85</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gfrance85</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">gfrance85</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">moral</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">gfrance85</span><span class="op">)</span><span class="op">[</span>, <span class="fl">7</span><span class="op">:</span><span class="fl">12</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Dmoral</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">moral</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span></span></span>
<span class="r-in"><span><span class="va">fG</span> <span class="op">&lt;-</span> <span class="va">gfrance85</span><span class="op">$</span><span class="va">Pop1831</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">gfrance85</span><span class="op">$</span><span class="va">Pop1831</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gnb</span> <span class="op">&lt;-</span> <span class="fu"><a href="poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">gfrance85</span>, row.names<span class="op">=</span><span class="va">gfrance85</span><span class="op">$</span><span class="va">Department</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frG</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2mat.html">nb2mat</a></span><span class="op">(</span><span class="va">gnb</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ldwG</span> <span class="op">&lt;-</span> <span class="fu">linearised_diffusive_weights</span><span class="op">(</span>adjacency_matrix<span class="op">=</span><span class="va">frG</span>, regional_weights<span class="op">=</span><span class="va">fG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mhwG</span> <span class="op">&lt;-</span> <span class="fu">metropolis_hastings_weights</span><span class="op">(</span>adjacency_matrix<span class="op">=</span><span class="va">frG</span>, regional_weights<span class="op">=</span><span class="va">fG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ifwG</span> <span class="op">&lt;-</span> <span class="fu">iterative_proportional_fitting_weights</span><span class="op">(</span>adjacency_matrix<span class="op">=</span><span class="va">frG</span>, regional_weights<span class="op">=</span><span class="va">fG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gdwG</span> <span class="op">&lt;-</span> <span class="fu">graph_distance_weights</span><span class="op">(</span>adjacency_matrix<span class="op">=</span><span class="va">frG</span>, regional_weights<span class="op">=</span><span class="va">fG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="va">moral_ldw</span> <span class="op">&lt;-</span> <span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="va">Dmoral</span>, adjusted_spatial_weights<span class="op">=</span><span class="va">ldwG</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">(</span><span class="fu">cornish_fisher</span><span class="op">(</span><span class="va">moral_ldw</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">moral_mhw</span> <span class="op">&lt;-</span> <span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="va">Dmoral</span>, adjusted_spatial_weights<span class="op">=</span><span class="va">mhwG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">moral_ifw</span> <span class="op">&lt;-</span> <span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="va">Dmoral</span>, adjusted_spatial_weights<span class="op">=</span><span class="va">ifwG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">moral_gdw</span> <span class="op">&lt;-</span> <span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="va">Dmoral</span>, adjusted_spatial_weights<span class="op">=</span><span class="va">gdwG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">moral_ldw</span>, cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mult<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Linearised Diffusive"</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">moral_mhw</span>, cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mult<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Metropolis-Hastings"</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">moral_ifw</span>, cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mult<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Iterative fitting"</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialcoords</span><span class="op">(</span><span class="va">moral_gdw</span>, cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mult<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"Graph distance"</span>, asp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">moral_ldw</span>, main<span class="op">=</span><span class="st">"linearised diffusive"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">moral_mhw</span>, main<span class="op">=</span><span class="st">"Metropolis-Hastings"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">moral_ifw</span>, main<span class="op">=</span><span class="st">"iterative fitting"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">plot_spatialscree</span><span class="op">(</span><span class="va">moral_gdw</span>, main<span class="op">=</span><span class="st">"graph distance"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Crime_pers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">gfrance85</span><span class="op">$</span><span class="va">Crime_pers</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">funif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Crime_pers</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Crime_pers</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">lw</span> <span class="op">&lt;-</span> <span class="fu"><a href="nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">gnb</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Crime_pers_delta</span> <span class="op">&lt;-</span> <span class="fu">spatialdelta</span><span class="op">(</span>dissimilarity_matrix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html" class="external-link">dist</a></span><span class="op">(</span><span class="va">Crime_pers</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,</span></span>
<span class="r-in"><span> adjusted_spatial_weights<span class="op">=</span><span class="fu"><a href="nb2mat.html">listw2mat</a></span><span class="op">(</span><span class="va">lw</span><span class="op">)</span>, regional_weights<span class="op">=</span><span class="va">funif</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Crime_pers_delta</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"delta"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">locdelta</span> <span class="op">&lt;-</span> <span class="fu">localdelta</span><span class="op">(</span><span class="va">Crime_pers_delta</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">Crime_pers</span>, <span class="va">lw</span>, randomisation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"Moran I statistic"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">locmoran</span> <span class="op">&lt;-</span> <span class="fu"><a href="localmoran.html">localmoran</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Crime_pers</span><span class="op">)</span>, <span class="va">lw</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">locmoran</span>, <span class="va">locdelta</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">moral_ldw</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"delta"</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Eq. 30 p. 588</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fG</span> <span class="op">*</span> <span class="fu">localdelta</span><span class="op">(</span><span class="va">moral_ldw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">moral_mhw</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"delta"</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Eq. 30 p. 588</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fG</span> <span class="op">*</span> <span class="fu">localdelta</span><span class="op">(</span><span class="va">moral_mhw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">moral_ifw</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"delta"</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Eq. 30 p. 588</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fG</span> <span class="op">*</span> <span class="fu">localdelta</span><span class="op">(</span><span class="va">moral_ifw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unname.html" class="external-link">unname</a></span><span class="op">(</span><span class="va">moral_gdw</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="st">"delta"</span><span class="op">]</span><span class="op">)</span>, <span class="co"># Eq. 30 p. 588</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">fG</span> <span class="op">*</span> <span class="fu">localdelta</span><span class="op">(</span><span class="va">moral_gdw</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-plt img"><img src="spatialdelta-1.png" alt="" width="700" height="433"></span>
<span class="r-plt img"><img src="spatialdelta-2.png" alt="" width="700" height="433"></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

