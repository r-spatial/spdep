<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Construct neighbours list from polygon list — poly2nb • spdep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Construct neighbours list from polygon list — poly2nb"><meta name="description" content="The function builds a neighbours list based on regions with contiguous boundaries, that is sharing one or more boundary point. The current function is in part interpreted and may run slowly for many regions or detailed boundaries, but from 0.2-16 should not fail because of lack of memory when single polygons are built of very many border coordinates."><meta property="og:description" content="The function builds a neighbours list based on regions with contiguous boundaries, that is sharing one or more boundary point. The current function is in part interpreted and may run slowly for many regions or detailed boundaries, but from 0.2-16 should not fail because of lack of memory when single polygons are built of very many border coordinates."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a></li>
    <li><a class="dropdown-item" href="../articles/nb_sf.html">Creating Neighbours using sf objects</a></li>
    <li><a class="dropdown-item" href="../articles/nb.html">Creating Neighbours</a></li>
    <li><a class="dropdown-item" href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a></li>
    <li><a class="dropdown-item" href="../articles/subgraphs.html">No-neighbour observation and subgraph handling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/spdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Construct neighbours list from polygon list</h1>

      <div class="d-none name"><code>poly2nb.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The function builds a neighbours list based on regions with contiguous boundaries, that is sharing one or more boundary point. The current function is in part interpreted and may run slowly for many regions or detailed boundaries, but from 0.2-16 should not fail because of lack of memory when single polygons are built of very many border coordinates.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">poly2nb</span><span class="op">(</span><span class="va">pl</span>, row.names <span class="op">=</span> <span class="cn">NULL</span>, snap<span class="op">=</span><span class="cn">NULL</span>, queen<span class="op">=</span><span class="cn">TRUE</span>, useC<span class="op">=</span><span class="cn">TRUE</span>, foundInBox<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-pl">pl<a class="anchor" aria-label="anchor" href="#arg-pl"></a></dt>
<dd><p>list of polygons of class extending <code>SpatialPolygons</code>, or an <code>sf</code> or <code>sfc</code> object containing non-empty (multi-)polygon objects</p></dd>

  <dt id="arg-row-names">row.names<a class="anchor" aria-label="anchor" href="#arg-row-names"></a></dt>
<dd><p>character vector of region ids to be added to the neighbours list as attribute <code>region.id</code>, default <code>seq(1, nrow(x))</code>; if <code>pl</code> has <code>row.names</code>, they are used instead of the default sequence.</p></dd>

  <dt id="arg-snap">snap<a class="anchor" aria-label="anchor" href="#arg-snap"></a></dt>
<dd><p>boundary points less than <code>snap</code> distance apart are considered to indicate contiguity; used both to find candidate and actual neighbours for planar geometries, but only actual neighbours for spherical geometries, as spherical spatial indexing itself injects some fuzzyness. If not set, for all <code>SpatialPolygons</code> objects, the default is as before <code>sqrt(.Machine$double.eps)</code>, with this value also used for <code>sf</code> objects with no coordinate reference system. For <code>sf</code> objects with a defined coordinate reference system, the default value is <code>1e-7</code> for geographical coordinates (approximately 10mm), is 10mm where projected coordinates are in metre units, and is converted from 10mm to the same distance in the units of the coordinates. Should the conversion fail, <code>snap</code> reverts to <code>sqrt(.Machine$double.eps)</code>.</p></dd>

  <dt id="arg-queen">queen<a class="anchor" aria-label="anchor" href="#arg-queen"></a></dt>
<dd><p>if TRUE, a single shared boundary point meets the contiguity condition, if FALSE, more than one shared point is required; note that more than one shared boundary point does not necessarily mean a shared boundary line</p></dd>

  <dt id="arg-usec">useC<a class="anchor" aria-label="anchor" href="#arg-usec"></a></dt>
<dd><p>default TRUE, doing the work loop in C, may be set to false to revert to R code calling two C functions in an <code>n*k</code> work loop, where <code>k</code> is the average number of candidate neighbours</p></dd>

  <dt id="arg-foundinbox">foundInBox<a class="anchor" aria-label="anchor" href="#arg-foundinbox"></a></dt>
<dd><p>default NULL using R code or <code><a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html" class="external-link">st_intersects()</a></code> to generate candidate neighbours (using <code>snap=</code> if the geometries are not spherical); if not NULL (for legacy purposes) a list of length <code>(n-1)</code> with integer vectors of candidate neighbours <code>(j &gt; i)</code> (as created by the <code>poly_findInBoxGEOS</code> function in <span class="pkg">rgeos</span> for clean polygons)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A neighbours list with class <code>nb</code>. See <code><a href="card.html">card</a></code> for details of “nb” objects.</p>
    </div>
    <div class="section level2">
    <h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a></h2>
    <p>From 0.5-8, the function includes faster bounding box indexing and other improvements contributed by Micah Altman. If a cluster is provided using <code>set.ClusterOption</code>, it will be used for finding candidate bounding box overlaps for exact testing for contiguity.</p>
<p>Until 1.1-7, <code>sf</code> polygons included both start and end points, so could erroneously report queen neighbourhood where only rook was present, see <a href="https://github.com/r-spatial/spdep/issues/50" class="external-link">https://github.com/r-spatial/spdep/issues/50</a>.</p>
<p>From 1.1-9 with <span class="pkg">sf</span> 1.0-0, <span class="pkg">s2</span> is used in bounding box indexing internally when <code>pl</code> is in geographical coordinates. Because the topology engine of <span class="pkg">s2</span> differs from the use of GEOS for planar coordinates by <span class="pkg">sf</span>, some output differences may be expected. Since treating spherical geometries as planar is also questionable, it is not clear whether spherical contiguous polygon neighbours should simply follow neighbours found by treating the geometries as planar <a href="https://github.com/r-spatial/s2/issues/125#issuecomment-864403372" class="external-link">https://github.com/r-spatial/s2/issues/125#issuecomment-864403372</a>. However, current advice is not necessarily to use <span class="pkg">s2</span> for finding contiguity neighbours, or at least to check output.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Roger Bivand <a href="mailto:Roger.Bivand@nhh.no">Roger.Bivand@nhh.no</a> with contributions from Micah Altman</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="summary.nb.html">summary.nb</a></code>, <code><a href="card.html">card</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">columbus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/columbus.gpkg"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">col.gal.nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="read.gal.html">read.gal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"weights/columbus.gal"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">columbus</span>, <span class="st">"Spatial"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dxx</span> <span class="op">&lt;-</span> <span class="fu"><a href="diffnb.html">diffnb</a></span><span class="op">(</span><span class="va">xx</span>, <span class="va">col.gal.nb</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 46 sub-graphs</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span>, border<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">col.gal.nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dxx</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Differences (red) in Columbus GAL weights (black)"</span>,</span></span>
<span class="r-in"><span> <span class="st">"and polygon generated queen weights"</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span>, cex.main<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poly2nb-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># poly2nb with sf sfc_MULTIPOLYGON objects</span></span></span>
<span class="r-in"><span><span class="va">sf_xx</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="diffnb.html">diffnb</a></span><span class="op">(</span><span class="va">sf_xx</span>, <span class="va">xx</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 49 sub-graphs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Neighbour list object:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of regions: 49 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of nonzero links: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percentage nonzero weights: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average number of links: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49 regions with no links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49 disjoint connected subgraphs</span>
<span class="r-in"><span><span class="va">sfc_xx</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="diffnb.html">diffnb</a></span><span class="op">(</span><span class="va">sfc_xx</span>, <span class="va">xx</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 49 sub-graphs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Neighbour list object:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of regions: 49 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of nonzero links: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percentage nonzero weights: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average number of links: 0 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49 regions with no links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38,</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49 disjoint connected subgraphs</span>
<span class="r-in"><span><span class="va">xxx</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">columbus</span>, <span class="st">"Spatial"</span><span class="op">)</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dxxx</span> <span class="op">&lt;-</span> <span class="fu"><a href="diffnb.html">diffnb</a></span><span class="op">(</span><span class="va">xxx</span>, <span class="va">col.gal.nb</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 34 sub-graphs</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span>, border <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">col.gal.nb</span>, <span class="va">coords</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dxxx</span>, <span class="va">coords</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Differences (red) in Columbus GAL weights (black)"</span>,</span></span>
<span class="r-in"><span> <span class="st">"and polygon generated rook weights"</span>, sep<span class="op">=</span><span class="st">"\n"</span><span class="op">)</span>, cex.main<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poly2nb-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">cards</span> <span class="op">&lt;-</span> <span class="fu"><a href="card.html">card</a></span><span class="op">(</span><span class="va">xx</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">maxconts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">cards</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">cards</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">maxconts</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="va">maxconts</span> <span class="op">&lt;-</span> <span class="va">maxconts</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">fg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"grey"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cards</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fg</span><span class="op">[</span><span class="va">maxconts</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"red"</span></span></span>
<span class="r-in"><span><span class="va">fg</span><span class="op">[</span><span class="va">xx</span><span class="op">[[</span><span class="va">maxconts</span><span class="op">]</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"green"</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span>, col<span class="op">=</span><span class="va">fg</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span>main<span class="op">=</span><span class="st">"Region with largest number of contiguities"</span>, cex.main<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poly2nb-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">nc.sids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/sids.gpkg"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, quiet<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">xxnb</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.046   0.000   0.047 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="va">xxnb</span> <span class="op">&lt;-</span> <span class="fu">poly2nb</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">nc.sids</span>, <span class="st">"Spatial"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    user  system elapsed </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.064   0.000   0.065 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xxnb</span>, <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">nc.sids</span><span class="op">)</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"blue"</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid assumes attributes are constant over geometries</span>
<span class="r-plt img"><img src="poly2nb-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="va">sq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sq2</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sq3</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sq4</span> <span class="op">&lt;-</span> <span class="va">sq</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">gm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sq</span>, <span class="va">sq2</span>, <span class="va">sq3</span>, <span class="va">sq4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gm</span>, id<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_centroid</a></span><span class="op">(</span><span class="va">gm</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="poly2nb-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">unclass</a></span><span class="op">(</span><span class="fu">poly2nb</span><span class="op">(</span><span class="va">df</span>, queen <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[3]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[4]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"region.id")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "1" "2" "3" "4"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"call")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> poly2nb(pl = df, queen = FALSE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"type")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "rook"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"snap")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.490116e-08</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"sym")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"ncomp")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"ncomp")$nc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"ncomp")$comp.id</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 1 1 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="va">col_geoms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">col_geoms</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="va">col_geoms</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, dist<span class="op">=</span><span class="op">-</span><span class="fl">0.05</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">col_geoms</span></span></span>
<span class="r-in"><span><span class="fu">poly2nb</span><span class="op">(</span><span class="va">columbus</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>some observations have no neighbours;</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> if this seems unexpected, try increasing the snap argument.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 2 sub-graphs;</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> if this sub-graph count seems unexpected, try increasing the snap argument.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Neighbour list object:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of regions: 49 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of nonzero links: 232 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Percentage nonzero weights: 9.662641 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Average number of links: 4.734694 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 region with no links:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 disjoint connected subgraphs</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

