<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Distance-based spatial weights for neighbours lists — nb2listwdist • spdep</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Distance-based spatial weights for neighbours lists — nb2listwdist"><meta name="description" content="The nb2listwdist function supplements a neighbours list with spatial weights for the chosen types of distance modelling and coding scheme. While the offered coding schemes parallel those of the nb2listw function, three distance-based types of weights are available: inverse distance weighting (IDW), double-power distance weights, and exponential distance decay. The can.be.simmed helper function checks whether a spatial weights object is similar to symmetric and can be so transformed to yield real eigenvalues or for Cholesky decomposition."><meta property="og:description" content="The nb2listwdist function supplements a neighbours list with spatial weights for the chosen types of distance modelling and coding scheme. While the offered coding schemes parallel those of the nb2listw function, three distance-based types of weights are available: inverse distance weighting (IDW), double-power distance weights, and exponential distance decay. The can.be.simmed helper function checks whether a spatial weights object is similar to symmetric and can be so transformed to yield real eigenvalues or for Cholesky decomposition."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4-1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a></li>
    <li><a class="dropdown-item" href="../articles/nb.html">Creating Neighbours</a></li>
    <li><a class="dropdown-item" href="../articles/nb_sf.html">Creating Neighbours using sf objects</a></li>
    <li><a class="dropdown-item" href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a></li>
    <li><a class="dropdown-item" href="../articles/subgraphs.html">No-neighbour observation and subgraph handling</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/spdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Distance-based spatial weights for neighbours lists</h1>

      <div class="d-none name"><code>nb2listwdist.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The <code>nb2listwdist</code> function supplements a neighbours list with spatial weights for the chosen types of distance modelling and coding scheme. While the offered coding schemes parallel those of the <code>nb2listw</code> function, three distance-based types of weights are available: inverse distance weighting (IDW), double-power distance weights, and exponential distance decay. The <code>can.be.simmed</code> helper function checks whether a spatial weights object is similar to symmetric and can be so transformed to yield real eigenvalues or for Cholesky decomposition.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nb2listwdist</span><span class="op">(</span><span class="va">neighbours</span>, <span class="va">x</span>, type<span class="op">=</span><span class="st">"idw"</span>, style<span class="op">=</span><span class="st">"raw"</span>, </span>
<span>  alpha <span class="op">=</span> <span class="fl">1</span>, dmax <span class="op">=</span> <span class="cn">NULL</span>, longlat <span class="op">=</span> <span class="cn">NULL</span>, zero.policy<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-neighbours">neighbours<a class="anchor" aria-label="anchor" href="#arg-neighbours"></a></dt>
<dd><p>an object of class <code>nb</code></p></dd>

  <dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>an <code>sp</code> <code>sf</code>, or <code>sfc</code> object</p></dd>

  <dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>default “idw”; the intended type of distance modelling, can take values “idw”, “exp”, and “dpd”</p></dd>

  <dt id="arg-style">style<a class="anchor" aria-label="anchor" href="#arg-style"></a></dt>
<dd><p>default “raw”; <code>style</code> can take values “raw”, “W”, “B”, “C”, “U”, “minmax”, and “S”</p></dd>

  <dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>default 0; a parameter for controlling the distance modelling, see “Details”</p></dd>

  <dt id="arg-dmax">dmax<a class="anchor" aria-label="anchor" href="#arg-dmax"></a></dt>
<dd><p>default NULL, maximum distance threshold that is required for type “dpd” but optional for all other types</p></dd>

  <dt id="arg-longlat">longlat<a class="anchor" aria-label="anchor" href="#arg-longlat"></a></dt>
<dd><p>default NULL; TRUE if point coordinates are longitude-latitude decimal degrees, in which case distances are measured in metres; if x is a SpatialPoints object, the value is taken from the object itself, and overrides this argument if not NULL; distances are measured in map units if FALSE or NULL</p></dd>

  <dt id="arg-zero-policy">zero.policy<a class="anchor" aria-label="anchor" href="#arg-zero-policy"></a></dt>
<dd><p>default NULL; use global option value; if FALSE stop with error for any empty neighbour sets, if TRUE permit the weights list to be formed with zero-length weights vectors</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Starting from a binary neighbours list, in which regions are either listed as neighbours or are absent (thus not in the set of neighbours for some definition), the function adds a distance-based weights list. Three types of distance weight calculations based on pairwise distances \(d_{ij}\) are possible, all of which are controlled by parameter “alpha” (\(\alpha\) below):
$$\textrm{idw: } w_{ij} = d_{ij}^{-\alpha},$$
$$\textrm{exp: } w_{ij} = \exp(-\alpha \cdot d_{ij}),$$
$$\textrm{dpd: } w_{ij} = \left[1 - \left(d_{ij}/d_{\textrm{max}}\right)^{\alpha}\right]^{\alpha},$$
the latter of which leads to \(w_{ij} = 0\) for all \(d_{ij} &gt; d_{\textrm{max}}\). Note that IDW weights show extreme behaviour close to 0 and can take on the value infinity. In such cases, the infinite values are replaced by the largest finite weight present in the weights list.</p>
<p>The default coding scheme is “raw”, which outputs the raw distance-based weights without applying any kind of normalisation. In addition, the same coding scheme styles that are also available in the <code>nb2listw</code> function can be chosen. B is the basic binary coding, W is row standardised (sums over all links to n), C is globally standardised (sums over all links to n), U is equal to C divided by the number of neighbours (sums over all links to unity), while S is the variance-stabilising coding scheme proposed by Tiefelsdorf et al. 1999, p. 167-168 (sums over all links to n). The “minmax” style is based on Kelejian and Prucha (2010), and divides the weights by the minimum of the maximum row sums and maximum column sums of the input weights. It is similar to the C and U styles; it is also available in Stata.</p>
<p>If zero.policy is set to TRUE, weights vectors of zero length are inserted for regions without neighbour in the neighbours list. These will in turn generate lag values of zero, equivalent to the sum of products of the zero row <code>t(rep(0, length=length(neighbours))) %*% x</code>, for arbitraty numerical vector <code>x</code> of length <code>length(neighbours)</code>. The spatially lagged value of x for the zero-neighbour region will then be zero, which may (or may not) be a sensible choice.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>listw</code> object with the following members:</p>
<dl><dt>style</dt>
<dd><p>one of W, B, C, U, S, minmax as above</p></dd>

  <dt>type</dt>
<dd><p>one of idw, exp, dpd as above</p></dd>

  <dt>neighbours</dt>
<dd><p>the input neighbours list</p></dd>

  <dt>weights</dt>
<dd><p>the weights for the neighbours and chosen style, with attributes set to report the type of relationships (binary or general, if general the form of the glist argument), and style as above</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Tiefelsdorf, M., Griffith, D. A., Boots, B. 1999 A variance-stabilizing coding scheme for spatial link matrices, Environment and Planning A, 31, pp. 165–180; Kelejian, H. H., and I. R. Prucha. 2010. Specification and estimation of spatial autoregressive models with autoregressive and heteroskedastic disturbances. Journal of Econometrics, 157: pp. 53–67.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Rene Westerholt <a href="mailto:rene.westerholt@tu-dortmund.de">rene.westerholt@tu-dortmund.de</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="nb2listw.html">nb2listw</a></code>, <code><a href="summary.nb.html">summary.nb</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># World examples</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">world</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># neighbours on distance interval [0, 1000] kilometres</span></span></span>
<span class="r-in"><span><span class="co"># suppressWarnings(st_crs(world) &lt;- "+proj=longlat") # for older PROJ</span></span></span>
<span class="r-in"><span><span class="va">pts</span> <span class="op">&lt;-</span> <span class="fu">st_centroid</span><span class="op">(</span><span class="fu">st_transform</span><span class="op">(</span><span class="va">world</span>, <span class="fl">3857</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>st_centroid assumes attributes are constant over geometries</span>
<span class="r-in"><span><span class="va">nb_world</span> <span class="op">&lt;-</span> <span class="fu"><a href="dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">pts</span>, <span class="fl">0</span>, <span class="fl">1000000</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>neighbour object has 46 sub-graphs</span>
<span class="r-in"><span><span class="co"># Moran's I (life expectancy) with IDW with alpha = 2, no coding scheme</span></span></span>
<span class="r-in"><span><span class="va">world_weights</span> <span class="op">&lt;-</span> <span class="fu">nb2listwdist</span><span class="op">(</span><span class="va">nb_world</span>, <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">pts</span>, <span class="st">"Spatial"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"idw"</span>,</span></span>
<span class="r-in"><span>  alpha <span class="op">=</span> <span class="fl">2</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="va">world_weights</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>NAs in lagged values</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 	Moran I test under randomisation</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> data:  world$lifeExp  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> weights: world_weights  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> n reduced by no-neighbour observations  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Moran I statistic standard deviate = 2.7769, p-value = 0.002744</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> alternative hypothesis: greater</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sample estimates:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Moran I statistic       Expectation          Variance </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       0.473883371      -0.007042254       0.029994057 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Moran's I (life expectancy) with IDW with alpha = 2, no coding scheme</span></span></span>
<span class="r-in"><span><span class="va">world_weights</span> <span class="op">&lt;-</span> <span class="fu">nb2listwdist</span><span class="op">(</span><span class="va">nb_world</span>, <span class="va">pts</span>, type <span class="op">=</span> <span class="st">"idw"</span>,</span></span>
<span class="r-in"><span>  alpha <span class="op">=</span> <span class="fl">2</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="va">world_weights</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Moran's I (life expectancy), DPD, alpha = 2, dmax = 1000 km, no coding scheme</span></span></span>
<span class="r-in"><span><span class="va">world_weights</span> <span class="op">&lt;-</span> <span class="fu">nb2listwdist</span><span class="op">(</span><span class="va">nb_world</span>, <span class="va">pts</span>, type <span class="op">=</span> <span class="st">"dpd"</span>,</span></span>
<span class="r-in"><span>  dmax <span class="op">=</span> <span class="fl">1000000</span>, alpha <span class="op">=</span> <span class="fl">2</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">world</span><span class="op">$</span><span class="va">lifeExp</span>, <span class="va">world_weights</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Boston examples</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">boston</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">boston_coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">boston.utm</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">boston.utm</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">boston.geoms</span> <span class="op">&lt;-</span> <span class="fu">st_as_sf</span><span class="op">(</span><span class="va">boston_coords</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, remove <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">nb_boston</span> <span class="op">&lt;-</span> <span class="fu"><a href="dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">boston.geoms</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Moran's I (crime) with exp weights with alpha = 2, no coding scheme</span></span></span>
<span class="r-in"><span><span class="va">boston_weights</span> <span class="op">&lt;-</span> <span class="fu">nb2listwdist</span><span class="op">(</span><span class="va">nb_boston</span>, <span class="va">boston.geoms</span>, type <span class="op">=</span> <span class="st">"exp"</span>, alpha <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  style<span class="op">=</span><span class="st">"raw"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">boston.c</span><span class="op">$</span><span class="va">CRIM</span>, <span class="va">boston_weights</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Moran's I (crime) with idw weights with alpha = 2, coding scheme = W</span></span></span>
<span class="r-in"><span><span class="va">boston_weights</span> <span class="op">&lt;-</span> <span class="fu">nb2listwdist</span><span class="op">(</span><span class="va">nb_boston</span>, <span class="va">boston.geoms</span>, type <span class="op">=</span> <span class="st">"idw"</span>, alpha <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  style<span class="op">=</span><span class="st">"W"</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">boston.c</span><span class="op">$</span><span class="va">CRIM</span>, <span class="va">boston_weights</span>, zero.policy <span class="op">=</span> <span class="cn">TRUE</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

