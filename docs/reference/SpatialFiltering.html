<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Semi-parametric spatial filtering — SpatialFiltering • spdep</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Semi-parametric spatial filtering — SpatialFiltering" />

<meta property="og:description" content="The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than tol. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a>
    </li>
    <li>
      <a href="../articles/SpatialFiltering.html">Moran Eigenvectors</a>
    </li>
    <li>
      <a href="../articles/nb_igraph.html">Spatial weights objects as sparse matrices and graphs</a>
    </li>
    <li>
      <a href="../articles/nb_sf.html">Creating Neighbours using sf objects</a>
    </li>
    <li>
      <a href="../articles/sids.html">Introduction to the North Carolina SIDS data set (revised)</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/r-spatial/spdep">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Semi-parametric spatial filtering</h1>
    
    <div class="hidden name"><code>SpatialFiltering.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function selects eigenvectors in a semi-parametric spatial filtering approach to removing spatial dependence from linear models. Selection is by brute force by finding the single eigenvector reducing the standard variate of Moran's I for regression residuals most, and continuing until no candidate eigenvector reduces the value by more than <code>tol</code>. It returns a summary table from the selection process and a matrix of selected eigenvectors for the specified model.</p>
    
    </div>

    <pre class="usage"><span class='fu'>SpatialFiltering</span>(<span class='no'>formula</span>, <span class='no'>lagformula</span>, <span class='no'>data</span>, <span class='no'>na.action</span>, <span class='no'>nb</span>, <span class='kw'>glist</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
 <span class='kw'>style</span> <span class='kw'>=</span> <span class='st'>"C"</span>, <span class='kw'>zero.policy</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>0.1</span>, <span class='kw'>zerovalue</span> <span class='kw'>=</span> <span class='fl'>1e-04</span>,
 <span class='kw'>ExactEV</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>symmetric</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>alpha</span><span class='kw'>=</span><span class='kw'>NULL</span>, <span class='kw'>alternative</span><span class='kw'>=</span><span class='st'>"two.sided"</span>,
 <span class='kw'>verbose</span><span class='kw'>=</span><span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>a symbolic description of the model to be fit, assuming a spatial error representation; when lagformula is given, it should include only the response and the intercept term</p></td>
    </tr>
    <tr>
      <th>lagformula</th>
      <td><p>An extra one-sided formula to be used when a spatial lag representation is desired; the intercept is excluded within the function if present because it is part of the formula argument, but excluding it explicitly in the lagformula argument in the presence of factors generates a collinear model matrix</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>an optional data frame containing the variables in the model</p></td>
    </tr>
    <tr>
      <th>nb</th>
      <td><p>an object of class <code>nb</code></p></td>
    </tr>
    <tr>
      <th>glist</th>
      <td><p>list of general weights corresponding to neighbours</p></td>
    </tr>
    <tr>
      <th>style</th>
      <td><p><code>style</code> can take values W, B, C, U, and S</p></td>
    </tr>
    <tr>
      <th>na.action</th>
      <td><p>a function (default <code><a href='https://www.rdocumentation.org/packages/base/topics/options'>options("na.action")</a></code>), can also be <code>na.omit</code> or <code>na.exclude</code> with consequences for residuals and fitted values - in these cases the spatial weights list will be subsetted to remove NAs in the data. It may be necessary to set zero.policy to TRUE because this subsetting may create no-neighbour observations. Note that only weights lists created without using the glist argument to <code>nb2listw</code> may be subsetted.</p></td>
    </tr>
    <tr>
      <th>zero.policy</th>
      <td><p>default NULL, use global option value; if FALSE stop with error for any empty neighbour sets, if TRUE permit the weights list to be formed with zero-length weights vectors</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>tolerance value for convergence of spatial filtering</p></td>
    </tr>
    <tr>
      <th>zerovalue</th>
      <td><p>eigenvectors with eigenvalues of an absolute value smaller than zerovalue will be excluded in eigenvector search</p></td>
    </tr>
    <tr>
      <th>ExactEV</th>
      <td><p>Set ExactEV=TRUE to use exact expectations and variances rather than the expectation and variance of Moran's I from the previous iteration, default FALSE</p></td>
    </tr>
    <tr>
      <th>symmetric</th>
      <td><p>Should the spatial weights matrix be forced to symmetry, default TRUE</p></td>
    </tr>
    <tr>
      <th>alpha</th>
      <td><p>if not NULL, used instead of the tol= argument as a stopping rule to choose all eigenvectors up to and including the one with a probability value exceeding alpha.</p></td>
    </tr>
    <tr>
      <th>alternative</th>
      <td><p>a character string specifying the alternative hypothesis, must be one of greater, less or two.sided (default).</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>default NULL, use global option value; if TRUE report eigenvectors selected</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>An <code>SFResult</code> object, with:</p>
<dt>selection</dt><dd><p>a matrix summarising the selection of eigenvectors for inclusion, with columns:
    <dl class='dl-horizontal'>
      <dt>Step</dt><dd><p>Step counter of the selection procedure</p></dd>
      <dt>SelEvec</dt><dd><p>number of selected eigenvector (sorted descending)</p></dd>
      <dt>Eval</dt><dd><p>its associated eigenvalue</p></dd>
      <dt>MinMi</dt><dd><p>value Moran's I for residual autocorrelation</p></dd>
      <dt>ZMinMi</dt><dd><p>standardized value of Moran's I assuming a normal approximation</p></dd>
      <dt>pr(ZI)</dt><dd><p>probability value of the permutation-based standardized deviate for the given value of the alternative argument</p></dd>
      <dt>R2</dt><dd><p>R\^2 of the model including exogenous variables and eigenvectors</p></dd>
      <dt>gamma</dt><dd><p>regression coefficient of selected eigenvector in fit</p></dd>
    </dl>
    The first row is the value at the start of the search</p></dd>
  <dt>dataset</dt><dd><p>a matrix of the selected eigenvectors in order of selection</p></dd>

    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Tiefelsdorf M, Griffith DA. (2007) Semiparametric Filtering of Spatial Autocorrelation: The Eigenvector Approach. Environment and Planning A, 39 (5) 1193 - 1221.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></code>, <code><a href='https://www.rdocumentation.org/packages/base/topics/eigen'>eigen</a></code>, <code><a href='nb2listw.html'>nb2listw</a></code>, <code><a href='lm.morantest.html'>listw2U</a></code></p></div>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='no'>run</span> <span class='kw'>&lt;-</span> <span class='fl'>FALSE</span>
<span class='kw'>if</span> (<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>require</a></span>(<span class='no'>sf</span>, <span class='kw'>quietly</span><span class='kw'>=</span><span class='fl'>TRUE</span>)) <span class='no'>run</span> <span class='kw'>&lt;-</span> <span class='fl'>TRUE</span>
<span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='no'>columbus</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/sf/topics/st_read'>st_read</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"shapes/columbus.shp"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)[<span class='fl'>1</span>], <span class='kw'>quiet</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>col.gal.nb</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='read.gal.html'>read.gal</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/system.file'>system.file</a></span>(<span class='st'>"weights/columbus.gal"</span>, <span class='kw'>package</span><span class='kw'>=</span><span class='st'>"spData"</span>)[<span class='fl'>1</span>])
<span class='no'>lmbase</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>)
<span class='no'>sarcol</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialFiltering</span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>,
 <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>col.gal.nb</span>, <span class='kw'>style</span><span class='kw'>=</span><span class='st'>"W"</span>, <span class='kw'>ExactEV</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='no'>sarcol</span>
}</div><div class='output co'>#&gt;   Step SelEvec      Eval        MinMi      ZMinMi      Pr(ZI)        R2
#&gt; 0    0       0 0.0000000  0.212374153  2.68100025 0.007340246 0.5524040
#&gt; 1    1       5 0.7148326  0.121528166  1.89037770 0.058707464 0.6209393
#&gt; 2    2       3 0.8408661  0.065848648  1.54064108 0.123404165 0.6481722
#&gt; 3    3       1 1.0206316 -0.005424824  1.08514557 0.277857187 0.6726114
#&gt; 4    4      10 0.3658588 -0.039356232  0.80357070 0.421644951 0.7000258
#&gt; 5    5      14 0.1831325 -0.072949543  0.47790213 0.632719864 0.7393770
#&gt; 6    6      11 0.3144120 -0.108332631  0.18566599 0.852706701 0.7611907
#&gt; 7    7       2 0.9157325 -0.153675621 -0.03464097 0.972366030 0.7713163
#&gt;       gamma
#&gt; 0   0.00000
#&gt; 1  30.34786
#&gt; 2  19.13010
#&gt; 3 -18.12234
#&gt; 4  19.19379
#&gt; 5  22.99586
#&gt; 6  17.12127
#&gt; 7  11.66487</div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='no'>lmsar</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> + <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/fitted.values'>fitted</a></span>(<span class='no'>sarcol</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>)
<span class='no'>lmsar</span>
}</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; lm(formula = CRIME ~ INC + HOVAL + fitted(sarcol), data = columbus)
#&gt; 
#&gt; Coefficients:
#&gt;         (Intercept)                  INC                HOVAL  
#&gt;             68.6190              -1.5973              -0.2739  
#&gt;  fitted(sarcol)vec5   fitted(sarcol)vec3   fitted(sarcol)vec1  
#&gt;             30.3479              19.1301             -18.1223  
#&gt; fitted(sarcol)vec10  fitted(sarcol)vec14  fitted(sarcol)vec11  
#&gt;             19.1938              22.9959              17.1213  
#&gt;  fitted(sarcol)vec2  
#&gt;             11.6649  
#&gt; </div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/anova'>anova</a></span>(<span class='no'>lmbase</span>, <span class='no'>lmsar</span>)
}</div><div class='output co'>#&gt; Analysis of Variance Table
#&gt; 
#&gt; Model 1: CRIME ~ INC + HOVAL
#&gt; Model 2: CRIME ~ INC + HOVAL + fitted(sarcol)
#&gt;   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
#&gt; 1     46 6014.9                                  
#&gt; 2     39 3073.1  7    2941.8 5.3334 0.0002445 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='fu'><a href='lm.morantest.html'>lm.morantest</a></span>(<span class='no'>lmsar</span>, <span class='fu'><a href='nb2listw.html'>nb2listw</a></span>(<span class='no'>col.gal.nb</span>))
}</div><div class='output co'>#&gt; 
#&gt; 	Global Moran I for regression residuals
#&gt; 
#&gt; data:  
#&gt; model: lm(formula = CRIME ~ INC + HOVAL + fitted(sarcol), data =
#&gt; columbus)
#&gt; weights: nb2listw(col.gal.nb)
#&gt; 
#&gt; Moran I statistic standard deviate = -0.034641, p-value = 0.5138
#&gt; alternative hypothesis: greater
#&gt; sample estimates:
#&gt; Observed Moran I      Expectation         Variance 
#&gt;     -0.153675621     -0.150918131      0.006336477 
#&gt; </div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='no'>lagcol</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialFiltering</span>(<span class='no'>CRIME</span> ~ <span class='fl'>1</span>, ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> - <span class='fl'>1</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>,
 <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>col.gal.nb</span>, <span class='kw'>style</span><span class='kw'>=</span><span class='st'>"W"</span>)
<span class='no'>lagcol</span>
}</div><div class='output co'>#&gt;    Step SelEvec      Eval       MinMi      ZMinMi      Pr(ZI)        R2
#&gt; 0     0       0 0.0000000  0.21237415  2.68100025 0.007340246 0.5524040
#&gt; 1     1       6 0.7161123  0.11782248  1.84511963 0.065020139 0.6038801
#&gt; 2     2       4 0.8682938  0.06242664  1.49482111 0.134961136 0.6531288
#&gt; 3     3       1 1.0310063 -0.02066604  0.88134183 0.378132834 0.6924845
#&gt; 4     4       5 0.7905397 -0.04619973  0.84746904 0.396733736 0.7136578
#&gt; 5     5      15 0.1753342 -0.07609524  0.55233191 0.580720971 0.7558543
#&gt; 6     6       9 0.5501433 -0.10190889  0.43919419 0.660520837 0.7626784
#&gt; 7     7       8 0.5721041 -0.12232942  0.41846803 0.675604953 0.7757314
#&gt; 8     8       3 0.9026222 -0.14991822  0.38315383 0.701605709 0.7908693
#&gt; 9     9       2 0.9649166 -0.21756342 -0.28556733 0.775209527 0.8078727
#&gt; 10   10       7 0.6219404 -0.22017920 -0.04856547 0.961265592 0.8082842
#&gt;         gamma
#&gt; 0    0.000000
#&gt; 1   19.848854
#&gt; 2   35.542595
#&gt; 3  -30.697851
#&gt; 4  -24.540372
#&gt; 5   25.227798
#&gt; 6    7.590082
#&gt; 7  -16.933168
#&gt; 8  -20.556931
#&gt; 9  -18.434534
#&gt; 10  -2.597572</div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='no'>lmlag</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> + <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/fitted.values'>fitted</a></span>(<span class='no'>lagcol</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>columbus</span>)
<span class='no'>lmlag</span>
}</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; lm(formula = CRIME ~ INC + HOVAL + fitted(lagcol), data = columbus)
#&gt; 
#&gt; Coefficients:
#&gt;         (Intercept)                  INC                HOVAL  
#&gt;             56.7977              -0.4857              -0.3821  
#&gt;  fitted(lagcol)vec6   fitted(lagcol)vec4   fitted(lagcol)vec1  
#&gt;             19.8489              35.5426             -30.6979  
#&gt;  fitted(lagcol)vec5  fitted(lagcol)vec15   fitted(lagcol)vec9  
#&gt;            -24.5404              25.2278               7.5901  
#&gt;  fitted(lagcol)vec8   fitted(lagcol)vec3   fitted(lagcol)vec2  
#&gt;            -16.9332             -20.5569             -18.4345  
#&gt;  fitted(lagcol)vec7  
#&gt;             -2.5976  
#&gt; </div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/anova'>anova</a></span>(<span class='no'>lmbase</span>, <span class='no'>lmlag</span>)
}</div><div class='output co'>#&gt; Analysis of Variance Table
#&gt; 
#&gt; Model 1: CRIME ~ INC + HOVAL
#&gt; Model 2: CRIME ~ INC + HOVAL + fitted(lagcol)
#&gt;   Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
#&gt; 1     46 6014.9                                  
#&gt; 2     36 2576.3 10    3438.6 4.8049 0.0002165 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='fu'><a href='lm.morantest.html'>lm.morantest</a></span>(<span class='no'>lmlag</span>, <span class='fu'><a href='nb2listw.html'>nb2listw</a></span>(<span class='no'>col.gal.nb</span>))
}</div><div class='output co'>#&gt; 
#&gt; 	Global Moran I for regression residuals
#&gt; 
#&gt; data:  
#&gt; model: lm(formula = CRIME ~ INC + HOVAL + fitted(lagcol), data =
#&gt; columbus)
#&gt; weights: nb2listw(col.gal.nb)
#&gt; 
#&gt; Moran I statistic standard deviate = -0.048565, p-value = 0.5194
#&gt; alternative hypothesis: greater
#&gt; sample estimates:
#&gt; Observed Moran I      Expectation         Variance 
#&gt;     -0.220179195     -0.217083975      0.004061888 
#&gt; </div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='no'>NA.columbus</span> <span class='kw'>&lt;-</span> <span class='no'>columbus</span>
<span class='no'>NA.columbus</span>$<span class='no'>CRIME</span>[<span class='fl'>20</span>:<span class='fl'>25</span>] <span class='kw'>&lt;-</span> <span class='fl'>NA</span>
<span class='no'>COL.SF.NA</span> <span class='kw'>&lt;-</span> <span class='fu'>SpatialFiltering</span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>NA.columbus</span>,
 <span class='kw'>nb</span><span class='kw'>=</span><span class='no'>col.gal.nb</span>, <span class='kw'>style</span><span class='kw'>=</span><span class='st'>"W"</span>, <span class='kw'>na.action</span><span class='kw'>=</span><span class='no'>na.exclude</span>)
<span class='no'>COL.SF.NA</span>$<span class='no'>na.action</span>
}</div><div class='output co'>#&gt; 20 21 22 23 24 25 
#&gt; 20 21 22 23 24 25 
#&gt; attr(,"class")
#&gt; [1] "exclude"</div><div class='input'><span class='kw'>if</span> (<span class='no'>run</span>) {
<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/summary'>summary</a></span>(<span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/lm'>lm</a></span>(<span class='no'>CRIME</span> ~ <span class='no'>INC</span> + <span class='no'>HOVAL</span> + <span class='fu'><a href='https://www.rdocumentation.org/packages/stats/topics/fitted.values'>fitted</a></span>(<span class='no'>COL.SF.NA</span>), <span class='kw'>data</span><span class='kw'>=</span><span class='no'>NA.columbus</span>,
 <span class='kw'>na.action</span><span class='kw'>=</span><span class='no'>na.exclude</span>))
}</div><div class='output co'>#&gt; 
#&gt; Call:
#&gt; lm(formula = CRIME ~ INC + HOVAL + fitted(COL.SF.NA), data = NA.columbus, 
#&gt;     na.action = na.exclude)
#&gt; 
#&gt; Residuals:
#&gt;      Min       1Q   Median       3Q      Max 
#&gt; -23.6712  -4.7984   0.1761   6.7460  11.3353 
#&gt; 
#&gt; Coefficients:
#&gt;                     Estimate Std. Error t value Pr(&gt;|t|)    
#&gt; (Intercept)         69.04674    3.91643  17.630  &lt; 2e-16 ***
#&gt; INC                 -1.60115    0.26017  -6.154 3.88e-07 ***
#&gt; HOVAL               -0.28742    0.07716  -3.725 0.000649 ***
#&gt; fitted(COL.SF.NA)1 -39.91305    8.23597  -4.846 2.27e-05 ***
#&gt; fitted(COL.SF.NA)2  19.81805    8.23597   2.406 0.021226 *  
#&gt; fitted(COL.SF.NA)3 -35.07336    8.23597  -4.259 0.000135 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; 
#&gt; Residual standard error: 8.236 on 37 degrees of freedom
#&gt;   (6 observations deleted due to missingness)
#&gt; Multiple R-squared:  0.7772,	Adjusted R-squared:  0.7471 
#&gt; F-statistic: 25.81 on 5 and 37 DF,  p-value: 3.996e-11
#&gt; </div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>Yongwan Chun, Michael Tiefelsdorf, Roger Bivand</p>
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

