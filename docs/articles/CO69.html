<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>“The Problem of Spatial Autocorrelation:” forty years on • spdep</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="“The Problem of Spatial Autocorrelation:” forty years on">
<meta property="og:description" content="spdep">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">spdep</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2-6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a>
    </li>
    <li>
      <a href="../articles/nb.html">Creating Neighbours</a>
    </li>
    <li>
      <a href="../articles/nb_sf.html">Creating Neighbours using sf objects</a>
    </li>
    <li>
      <a href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-spatial/spdep/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>“The Problem of Spatial Autocorrelation:” forty years on</h1>
                        <h4 data-toc-skip class="author">Roger Bivand</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/spdep/blob/HEAD/vignettes/CO69.Rmd" class="external-link"><code>vignettes/CO69.Rmd</code></a></small>
      <div class="hidden name"><code>CO69.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><span class="citation">Cliff and Ord (1969)</span>, published forty years ago, marked a turning point in the treatment of spatial autocorrelation in quantitative geography. It provided the framework needed by any applied researcher to attempt an implementation for a different system, possibly using a different programming language. In this spirit, here we examine how spatial weights have been represented in implementations and may be reproduced, how the tabulated results in the paper may be reproduced, and how they may be extended to cover simulation.</p>
<p>One of the major assertions of <span class="citation">Cliff and Ord (1969)</span> is that their statistic advances the measurement of spatial autocorrelation with respect to <span class="citation">Moran (1950)</span> and <span class="citation">Geary (1954)</span> because a more general specification of spatial weights could be used. This more general form has implications both for the preparation of the weights themselves, and for the calculation of the measures. We will look at spatial weights first, before moving on to consider the measures presented in the paper and some of their subsequent developments. Before doing this, we will put together a data set matching that used in <span class="citation">Cliff and Ord (1969)</span>. They provide tabulated data for the counties of the Irish Republic, but omit Dublin from analyses. A shapefile included in this package, kindly made available by Michael Tiefelsdorf, is used as a starting point:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span></span>
<span><span class="va">eire</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/eire.shp"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="st">"Spatial"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">eire</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">eire</span><span class="op">$</span><span class="va">names</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/sp/man/is.projected.html" class="external-link">proj4string</a></span><span class="op">(</span><span class="va">eire</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/CRS-class.html" class="external-link">CRS</a></span><span class="op">(</span><span class="st">"+proj=utm +zone=30 +ellps=airy +units=km"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">eire</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "SpatialPolygonsDataFrame"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "sp"</span></span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">eire</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "A"       "towns"   "pale"    "size"    "ROADACC" "OWNCONS" "POPCHG" </span></span>
<span><span class="co">##  [8] "RETSALE" "INCOME"  "names"</span></span></code></pre>
<p>and read into a SpatialPolygonsDataFrame — classes used for handling spatial data in are fully described in <span class="citation">Roger S. Bivand, Pebesma, and Gómez-Rubio (2008)</span>. To this we need to add the data tabulated in the paper in Table 2,<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> p. 40, here in the form of a text file with added rainfall values from Table 9, p. 49:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"etc/misc/geary_eire.txt"</span>, package<span class="op">=</span><span class="st">"spdep"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">ge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fn</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ge</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "serlet"        "county"        "pagval2_10"    "pagval10_50"  </span></span>
<span><span class="co">##  [5] "pagval50p"     "cowspacre"     "ocattlepacre"  "pigspacre"    </span></span>
<span><span class="co">##  [9] "sheeppacre"    "townvillp"     "carspcap"      "radiopcap"    </span></span>
<span><span class="co">## [13] "retailpcap"    "psinglem30_34" "rainfall"</span></span></code></pre>
<p>Since we assigned the county names as feature identifiers when reading the shapefiles, we do the same with the extra data, and combine the objects:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">ge</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">ge</span><span class="op">$</span><span class="va">county</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">ge</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">eire</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eire_ge</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">eire</span>, <span class="va">ge</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we need to drop the Dublin county omitted in the analyses conducted in <span class="citation">Cliff and Ord (1969)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eire_ge1</span> <span class="op">&lt;-</span> <span class="va">eire_ge</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">eire_ge</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"Dublin"</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 25</span></span></code></pre>
<p>To double-check our data, let us calculate the sample Beta coefficients, using the formulae given in the paper for sample moments:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">skewness</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">z</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>; <span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="va">kurtosis</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">z</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>; <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">^</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">}</span></span></code></pre></div>
<p>These differ somewhat from the ways in which skewness and kurtosis are computed in modern statistical software, see for example <span class="citation">Joanes and Gill (1998)</span>. However, for our purposes, they let us reproduce Table 3, p. 42:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">eire_ge1</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span>, <span class="va">skewness</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    pagval2_10   pagval10_50     pagval50p     cowspacre  ocattlepacre </span></span>
<span><span class="co">##      1.675429      1.294978      0.000382      1.682094      0.086267 </span></span>
<span><span class="co">##     pigspacre    sheeppacre     townvillp      carspcap     radiopcap </span></span>
<span><span class="co">##      1.138387      1.842362      0.472748      0.011111      0.342805 </span></span>
<span><span class="co">##    retailpcap psinglem30_34 </span></span>
<span><span class="co">##      0.002765      0.068169</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">eire_ge1</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span><span class="fl">13</span><span class="op">:</span><span class="fl">24</span><span class="op">]</span>, <span class="va">kurtosis</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    pagval2_10   pagval10_50     pagval50p     cowspacre  ocattlepacre </span></span>
<span><span class="co">##         3.790         4.331         1.508         4.294         2.985 </span></span>
<span><span class="co">##     pigspacre    sheeppacre     townvillp      carspcap     radiopcap </span></span>
<span><span class="co">##         3.754         4.527         2.619         1.865         2.730 </span></span>
<span><span class="co">##    retailpcap psinglem30_34 </span></span>
<span><span class="co">##         2.188         2.034</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">eire_ge1</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">16</span>,<span class="fl">18</span>,<span class="fl">19</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">skewness</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## pagval2_10  cowspacre  pigspacre sheeppacre </span></span>
<span><span class="co">##    0.68801    0.17875    0.00767    0.04184</span></span></code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">eire_ge1</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">13</span>,<span class="fl">16</span>,<span class="fl">18</span>,<span class="fl">19</span><span class="op">)</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">kurtosis</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## pagval2_10  cowspacre  pigspacre sheeppacre </span></span>
<span><span class="co">##      2.883      2.799      2.212      2.421</span></span></code></pre>
<p>Using the tabulated value of <span class="math inline">\(23.6\)</span> for the percentage of agricultural holdings above 50 in 1950 in Waterford, the skewness and kurtosis cannot be reproduced, but by comparison with the <span><code>irishdata</code></span> dataset in , it turns out that the value should rather be <span class="math inline">\(26.6\)</span>, which yields the tabulated skewness and kurtosis values.</p>
<p>Before going on, the variables considered are presented in Table <span class="math display">\[vars\]</span>.</p>
<table class="table">
<caption>Description of variables in the Geary data set.<span data-label="vars"></span>
</caption>
<thead><tr class="header">
<th align="left">variable</th>
<th align="left">description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">pagval2_10</td>
<td align="left">Percentage number agricultural holdings in valuation group £2–£10 (1950)</td>
</tr>
<tr class="even">
<td align="left">pagval10_50</td>
<td align="left">Percentage number agricultural holdings in valuation group £10–£50 (1950)</td>
</tr>
<tr class="odd">
<td align="left">pagval50p</td>
<td align="left">Percentage number agricultural holdings in valuation group above £50 (1950)</td>
</tr>
<tr class="even">
<td align="left">cowspacre</td>
<td align="left">Milch cows per 1000 acres crops and pasture (1952)</td>
</tr>
<tr class="odd">
<td align="left">ocattlepacre</td>
<td align="left">Other cattle per 1000 acres crops and pasture (1952)</td>
</tr>
<tr class="even">
<td align="left">pigspacre</td>
<td align="left">Pigs per 1000 acres crops and pasture (1952)</td>
</tr>
<tr class="odd">
<td align="left">sheeppacre</td>
<td align="left">Sheep per 1000 acres crops and pasture (1952)</td>
</tr>
<tr class="even">
<td align="left">townvillp</td>
<td align="left">Town and village population as percentage of total (1951)</td>
</tr>
<tr class="odd">
<td align="left">carspcap</td>
<td align="left">Private cars registered per 1000 population (1952)</td>
</tr>
<tr class="even">
<td align="left">radiopcap</td>
<td align="left">Radio licences per 1000 population (1952)</td>
</tr>
<tr class="odd">
<td align="left">retailpcap</td>
<td align="left">Retail sales £ per person (1951)</td>
</tr>
<tr class="even">
<td align="left">psinglem30_34</td>
<td align="left">Single males as percentage of all males aged 30–34 (1951)</td>
</tr>
<tr class="odd">
<td align="left">rainfall</td>
<td align="left">Average of rainfall for stations in Ireland, 1916–1950, mm</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="spatial-weights">Spatial weights<a class="anchor" aria-label="anchor" href="#spatial-weights"></a>
</h2>
<p>As a basis for comparison, we will first read the unstandardised weighting matrix given in Table A1, p. 54, of the paper, reading a file corrected for the misprint giving O rather than D as a neighbour of V:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"etc/misc/unstand_sn.txt"</span>, package<span class="op">=</span><span class="st">"spdep"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">unstand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">fn</span>, header<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      from                to                weight        </span></span>
<span><span class="co">##  Length:110         Length:110         Min.   :0.000600  </span></span>
<span><span class="co">##  Class :character   Class :character   1st Qu.:0.003225  </span></span>
<span><span class="co">##  Mode  :character   Mode  :character   Median :0.007550  </span></span>
<span><span class="co">##                                        Mean   :0.007705  </span></span>
<span><span class="co">##                                        3rd Qu.:0.010225  </span></span>
<span><span class="co">##                                        Max.   :0.032400</span></span></code></pre>
<p>In the file, the counties are represented by their serial letters, so ordering and conversion to integer index representation is required to reach a representation similar to that of the SpatialStats module for spatial neighbours:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"spatial.neighbour"</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">of</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">$</span><span class="va">from</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">unstand</span>, <span class="st">"region.id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">of</span><span class="op">)</span></span>
<span><span class="va">unstand</span><span class="op">$</span><span class="va">from</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">of</span><span class="op">)</span></span>
<span><span class="va">unstand</span><span class="op">$</span><span class="va">to</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">ordered</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">$</span><span class="va">to</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">unstand</span>, <span class="st">"n"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">$</span><span class="va">from</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Having done this, we can change its representation to a <span><code>listw</code></span> object, assigning an appropriate style (generalised binary) for unstandardised values:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lw_unstand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/listw2sn.html">sn2listw</a></span><span class="op">(</span><span class="va">unstand</span><span class="op">)</span></span>
<span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">style</span> <span class="op">&lt;-</span> <span class="st">"B"</span></span>
<span><span class="va">lw_unstand</span></span></code></pre></div>
<pre><code><span><span class="co">## Characteristics of weights list object:</span></span>
<span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 25 </span></span>
<span><span class="co">## Number of nonzero links: 110 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.6 </span></span>
<span><span class="co">## Average number of links: 4.4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weights style: B </span></span>
<span><span class="co">## Weights constants summary:</span></span>
<span><span class="co">##    n  nn     S0         S1        S2</span></span>
<span><span class="co">## B 25 625 0.8476 0.01871808 0.1229232</span></span></code></pre>
<p>Note that the values of S0, S1, and S2 correspond closely with those given on page 42 of the paper, <span class="math inline">\(0.84688672\)</span>, <span class="math inline">\(0.01869986\)</span> and <span class="math inline">\(0.12267319\)</span>. The discrepancies appear to be due to rounding in the printed table of weights.</p>
<p>The contiguous neighbours represented in this object ought to match those found using <span><code>poly2nb</code></span>. However, we see that the reproduced contiguities have a smaller link count:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">)</span></span>
<span><span class="va">nb</span></span></code></pre></div>
<pre><code><span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 25 </span></span>
<span><span class="co">## Number of nonzero links: 108 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.28 </span></span>
<span><span class="co">## Average number of links: 4.32</span></span></code></pre>
<p>The missing link is between Clare and Kerry, perhaps by the Tarbert–Killimer ferry, but the counties are not contiguous, as Figure <span class="math display">\[plot\_nb\]</span> shows:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/diffnb.html">diffnb</a></span><span class="op">(</span><span class="va">nb</span>, <span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span>, verbose<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Neighbour difference for region id: Clare in relation to id: Kerry </span></span>
<span><span class="co">## Neighbour difference for region id: Kerry in relation to id: Clare</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">eire_ge1</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nb</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">xx</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="CO69_files/figure-html/unnamed-chunk-14-1.png" alt="County boundaries and contiguities" width="700"><p class="caption">
County boundaries and contiguities
</p>
</div>
<p>An attempt has also been made to reproduce the generalised weights for 25 Irish counties reported by <span class="citation">Cliff and Ord (1969)</span>, after Dublin is omitted. Reproducing the inverse distance component <span class="math inline">\(d_{ij}^{-1}\)</span> of the generalised weights <span class="math inline">\(d_{ij}^{-1} \beta_{i(j)}\)</span> is eased by the statement in <span class="citation">Cliff and Ord (1973, 55)</span> that the points chosen to represent the counties were their “geographic centres,” so not very different from the centroids yielded by applying a chosen computational geometry function. The distance metric is not given, and may have been in kilometers or miles — both were tried, but the results were not sensitive to the difference as it applies equally across the weights; miles are used here. Computing the proportion of shared distance measure <span class="math inline">\(\beta_{i(j)}\)</span> is harder, because it requires the availability of the full topology of the input polygons. <span class="citation">Roger S. Bivand, Pebesma, and Gómez-Rubio (2008, 244)</span> show how to employ the <span><code>vect2neigh</code></span> function (written by Markus Neteler) in the package when using GRASS GIS vector handling to create a full topology from spaghetti vector data and to extract border segment lengths; a similar approach also is mentioned there using ArcGIS coverages for the same purpose. GRASS was used to create the topology, and next the proportion of shared distance measure was calculated.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/terra/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="va">v_eire_ge1</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">)</span></span>
<span><span class="va">SG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rasterize.html" class="external-link">rasterize</a></span><span class="op">(</span><span class="va">v_eire_ge1</span>, <span class="fu"><a href="https://rdrr.io/pkg/terra/man/rast.html" class="external-link">rast</a></span><span class="op">(</span>nrows<span class="op">=</span><span class="fl">70</span>, ncols<span class="op">=</span><span class="fl">50</span>, extent<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">v_eire_ge1</span><span class="op">)</span><span class="op">)</span>, field<span class="op">=</span><span class="st">"county"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://grass.osgeo.org/" class="external-link">rgrass7</a></span><span class="op">)</span></span>
<span><span class="va">grass_home</span> <span class="op">&lt;-</span> <span class="st">"/home/rsb/topics/grass/g820/grass82"</span></span>
<span><span class="fu"><a href="https://rsbivand.github.io/rgrass/reference/initGRASS.html" class="external-link">initGRASS</a></span><span class="op">(</span><span class="va">grass_home</span>, home<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, SG<span class="op">=</span><span class="va">SG</span>, override<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rsbivand.github.io/rgrass/reference/readVECT.html" class="external-link">write_VECT</a></span><span class="op">(</span><span class="va">v_eire_ge1</span>, <span class="st">"eire"</span>, flags<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"o"</span>, <span class="st">"overwrite"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/rgrass/reference/readVECT.html" class="external-link">vect2neigh</a></span><span class="op">(</span><span class="st">"eire"</span>, ID<span class="op">=</span><span class="st">"serlet"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span><span class="op">$</span><span class="va">length</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">length</span><span class="op">*</span><span class="fl">1000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"external"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"external"</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"total"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"total"</span><span class="op">)</span><span class="op">*</span><span class="fl">1000</span></span>
<span><span class="va">grass_borders</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/listw2sn.html">sn2listw</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="va">raw_borders</span> <span class="op">&lt;-</span> <span class="va">grass_borders</span><span class="op">$</span><span class="va">weights</span></span>
<span><span class="va">int_tot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"total"</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"external"</span><span class="op">)</span></span>
<span><span class="va">prop_borders</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">int_tot</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">raw_borders</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">/</span><span class="va">int_tot</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">grass_borders</span><span class="op">$</span><span class="va">neighbours</span>, <span class="fu"><a href="https://rdrr.io/pkg/sp/man/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">inv_dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">dlist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fl">1.609344</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">combo_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">inv_dlist</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="va">inv_dlist</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">*</span><span class="va">prop_borders</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">combo_km_lw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">grass_borders</span><span class="op">$</span><span class="va">neighbours</span>, glist<span class="op">=</span><span class="va">combo_km</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">combo_km_lw</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Characteristics of weights list object:</span></span>
<span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 25 </span></span>
<span><span class="co">## Number of nonzero links: 108 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.28 </span></span>
<span><span class="co">## Average number of links: 4.32 </span></span>
<span><span class="co">## Link number distribution:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1 2 3 4 5 6 7 8 </span></span>
<span><span class="co">## 1 2 5 5 8 1 2 1 </span></span>
<span><span class="co">## 1 least connected region:</span></span>
<span><span class="co">## E with 1 link</span></span>
<span><span class="co">## 1 most connected region:</span></span>
<span><span class="co">## V with 8 links</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weights style: B </span></span>
<span><span class="co">## Weights constants summary:</span></span>
<span><span class="co">##    n  nn        S0       S1.5        S2</span></span>
<span><span class="co">## B 25 625 0.9083144 0.02191845 0.1427746</span></span></code></pre>
<p>To compare, we need to remove the Tarbert–Killimer ferry link manually, and view the summary of the original weights, as well as a correlation coefficient between these and the reconstructed weights. Naturally, unless the boundary coordinates used here are identical with those in the original analysis, presumably measured by hand, small differences will occur.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">red_lw_unstand</span> <span class="op">&lt;-</span> <span class="va">lw_unstand</span></span>
<span><span class="va">Clare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lw_unstand</span>, <span class="st">"region.id"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"C"</span><span class="op">)</span></span>
<span><span class="va">Kerry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">lw_unstand</span>, <span class="st">"region.id"</span><span class="op">)</span> <span class="op">==</span> <span class="st">"H"</span><span class="op">)</span></span>
<span><span class="va">Kerry_in_Clare</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">Clare</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">Kerry</span><span class="op">)</span></span>
<span><span class="va">Clare_in_Kerry</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">Kerry</span><span class="op">]</span><span class="op">]</span> <span class="op">==</span> <span class="va">Clare</span><span class="op">)</span></span>
<span><span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">Clare</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">Clare</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">Kerry_in_Clare</span><span class="op">]</span></span>
<span><span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">Kerry</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">[[</span><span class="va">Kerry</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">Clare_in_Kerry</span><span class="op">]</span></span>
<span><span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="va">Clare</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="va">Clare</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">Kerry_in_Clare</span><span class="op">]</span></span>
<span><span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="va">Kerry</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">weights</span><span class="op">[[</span><span class="va">Kerry</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="op">-</span><span class="va">Clare_in_Kerry</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">red_lw_unstand</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Characteristics of weights list object:</span></span>
<span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 25 </span></span>
<span><span class="co">## Number of nonzero links: 108 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.28 </span></span>
<span><span class="co">## Average number of links: 4.32 </span></span>
<span><span class="co">## Link number distribution:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## 1 2 3 4 5 6 7 8 </span></span>
<span><span class="co">## 1 2 5 5 8 1 2 1 </span></span>
<span><span class="co">## 1 least connected region:</span></span>
<span><span class="co">## E with 1 link</span></span>
<span><span class="co">## 1 most connected region:</span></span>
<span><span class="co">## V with 8 links</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weights style: B </span></span>
<span><span class="co">## Weights constants summary:</span></span>
<span><span class="co">##    n  nn     S0         S1        S2</span></span>
<span><span class="co">## B 25 625 0.8437 0.01870287 0.1222501</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">red_lw_unstand</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">combo_km_lw</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.969543</span></span></code></pre>
<p>Even though the differences in the general weights, for identical contiguities, are so small, the consequences for the measure of spatial autocorrelation are substantial, Here we use the fifth variable, other cattle per 1000 acres crops and pasture (1952), and see that the reconstructed weights seem to “reveal” more autocorrelation than the original weights.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flatten</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">digits</span><span class="op">=</span><span class="fl">3</span>, <span class="va">statistic</span><span class="op">=</span><span class="st">"I"</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">estimate</span>, digits<span class="op">=</span><span class="va">digits</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">statistic</span>, digits<span class="op">=</span><span class="va">digits</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/format.pval.html" class="external-link">format.pval</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">p.value</span>, digits<span class="op">=</span><span class="va">digits</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">res</span>, ncol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"E"</span>, <span class="st">"V"</span>, <span class="st">"SD_"</span>, <span class="st">"P_"</span><span class="op">)</span>, <span class="st">"I"</span>, sep<span class="op">=</span><span class="st">""</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/deparse.html" class="external-link">deparse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html" class="external-link">substitute</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">res</span></span>
<span><span class="op">}</span></span>
<span><span class="va">`reconstructed weights`</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">ocattlepacre</span>, <span class="va">combo_km_lw</span><span class="op">)</span></span>
<span><span class="va">`original weights`</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">ocattlepacre</span>, <span class="va">red_lw_unstand</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu">flatten</span><span class="op">(</span><span class="va">`reconstructed weights`</span><span class="op">)</span>, <span class="fu">flatten</span><span class="op">(</span><span class="va">`original weights`</span><span class="op">)</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       I       EI      VI      SD_I P_I    </span></span>
<span><span class="co">## reconstructed weights  0.3203 -0.0417  0.0225 2.41 0.00792</span></span>
<span><span class="co">## original weights       0.2779 -0.0417  0.0223 2.14 0.0161</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="measures-of-spatial-autocorrelation">Measures of spatial autocorrelation<a class="anchor" aria-label="anchor" href="#measures-of-spatial-autocorrelation"></a>
</h2>
<p>Our targets for reproduction are Tables 4 and 5 in <span class="citation">Cliff and Ord (1969, 43–44)</span>, the first containing standard deviates under normality and randomisation for the original Moran measure with binary weights, the original Geary measure with binary weights, the proposed measure with unstandardised general weights, and the proposed measure with row-standardised general weights. In addition, four variables were log-transformed on the basis of the skewness and kurtosis results presented above. We carry out the transformation of these variables, and generate additional binary and row-standardised general spatial weights objects — note that the weights constants for the row-standardised general weights agree with those given on p. 42 in the paper, after allowing for small differences due to rounding in the weights values displayed in the paper (p. 54):</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">ln_pagval2_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">pagval2_10</span><span class="op">)</span></span>
<span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">ln_cowspacre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">cowspacre</span><span class="op">)</span></span>
<span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">ln_pigspacre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">pigspacre</span><span class="op">)</span></span>
<span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">ln_sheeppacre</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">$</span><span class="va">sheeppacre</span><span class="op">)</span></span>
<span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pagval2_10"</span>, <span class="st">"ln_pagval2_10"</span>, <span class="st">"pagval10_50"</span>, <span class="st">"pagval50p"</span>,</span>
<span> <span class="st">"cowspacre"</span>, <span class="st">"ln_cowspacre"</span>, <span class="st">"ocattlepacre"</span>, <span class="st">"pigspacre"</span>,</span>
<span> <span class="st">"ln_pigspacre"</span>, <span class="st">"sheeppacre"</span>, <span class="st">"ln_sheeppacre"</span>, <span class="st">"townvillp"</span>,</span>
<span> <span class="st">"carspcap"</span>, <span class="st">"radiopcap"</span>, <span class="st">"retailpcap"</span>, <span class="st">"psinglem30_34"</span><span class="op">)</span></span>
<span><span class="va">nb_B</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span></span>
<span><span class="va">nb_B</span></span></code></pre></div>
<pre><code><span><span class="co">## Characteristics of weights list object:</span></span>
<span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 25 </span></span>
<span><span class="co">## Number of nonzero links: 110 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.6 </span></span>
<span><span class="co">## Average number of links: 4.4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weights style: B </span></span>
<span><span class="co">## Weights constants summary:</span></span>
<span><span class="co">##    n  nn  S0  S1   S2</span></span>
<span><span class="co">## B 25 625 110 220 2176</span></span></code></pre>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lw_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span>, glist<span class="op">=</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">weights</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">lw_std</span></span></code></pre></div>
<pre><code><span><span class="co">## Characteristics of weights list object:</span></span>
<span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 25 </span></span>
<span><span class="co">## Number of nonzero links: 110 </span></span>
<span><span class="co">## Percentage nonzero weights: 17.6 </span></span>
<span><span class="co">## Average number of links: 4.4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Weights style: W </span></span>
<span><span class="co">## Weights constants summary:</span></span>
<span><span class="co">##    n  nn S0       S1       S2</span></span>
<span><span class="co">## W 25 625 25 15.84089 103.6197</span></span></code></pre>
<p>The standard representation of the measures is:</p>
<p><span class="math display">\[I = \frac{n}{\sum_{i=1}^{n}\sum_{j=1}^{n}w_{ij}}
\frac{\sum_{i=1}^{n}\sum_{j=1}^{n}w_{ij}(x_i-\bar{x})(x_j-\bar{x})}{\sum_{i=1}^{n}(x_i - \bar{x})^2}\]</span></p>
<p>for Moran’s <span class="math inline">\(I\)</span> — in the paper termed the proposed statistic, and for Geary’s <span class="math inline">\(C\)</span>:</p>
<p><span class="math display">\[C = \frac{(n-1)}{2\sum_{i=1}^{n}\sum_{j=1}^{n}w_{ij}}
\frac{\sum_{i=1}^{n}\sum_{j=1}^{n}w_{ij}(x_i-x_j)^2}{\sum_{i=1}^{n}(x_i - \bar{x})^2}\]</span></p>
<p>where <span class="math inline">\(x_i, i=1, \ldots, n\)</span> are <span class="math inline">\(n\)</span> observations on the numeric variable of interest, and <span class="math inline">\(w_{ij}\)</span> are the spatial weights. In order to reproduce the standard deviates given in the paper, it is sufficient to apply <span><code>moran.test</code></span> to the variables with three different spatial weights objects, and two different values of the <span><code>randomisation=</code></span> argument. In addition, <span><code>geary.test</code></span> is applied to a single spatial weights objects, and two different values of the <span><code>randomisation=</code></span> argument.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">MoranN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">nb_B</span>, randomisation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">MoranR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">nb_B</span>, randomisation<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GearyN</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/geary.test.html">geary.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">nb_B</span>, randomisation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">GearyR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/geary.test.html">geary.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">nb_B</span>, randomisation<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_unstdN</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">lw_unstand</span>, randomisation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_unstdR</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">lw_unstand</span>, randomisation<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_stdN</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">lw_std</span>, randomisation<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_stdR</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/moran.test.html">moran.test</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, listw<span class="op">=</span><span class="va">lw_std</span>, randomisation<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   0.113   0.010   0.124</span></span></code></pre>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MoranN"</span>, <span class="st">"MoranR"</span>, <span class="st">"GearyN"</span>, <span class="st">"GearyR"</span>, <span class="st">"Prop_unstdN"</span>, <span class="st">"Prop_unstdR"</span>, <span class="st">"Prop_stdN"</span>, <span class="st">"Prop_stdR"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="st">"statistic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span>
<span><span class="va">ores</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<p>In order to conduct 8 different tests on 16 variables, we use <span><code>lapply</code></span> on the list of variables in the specified order, then <span><code>sapply</code></span> on a list of output objects by name to generate a table in the same row and column order as the original (we save a copy of six columns for comparison with bootstrap results below):</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               MoranN MoranR GearyN  GearyR  Prop_unstdN Prop_unstdR Prop_stdN Prop_stdR</span></span>
<span><span class="co">## pagval2_10    3.7851 3.8779 4.3142  3.9016  3.3307      3.4159      3.9276    4.0292   </span></span>
<span><span class="co">## ln_pagval2_10 4.0965 4.1074 4.0841  4.0343  3.5795      3.5894      4.1278    4.1393   </span></span>
<span><span class="co">## pagval10_50   1.0899 1.1316 2.7511  2.3760  1.3348      1.3882      1.5127    1.5738   </span></span>
<span><span class="co">## pagval50p     5.2011 5.0555 4.0178  4.7194  4.6604      4.5247      4.8823    4.7387   </span></span>
<span><span class="co">## cowspacre     5.1969 5.3907 4.3531  3.7709  4.1379      4.2991      4.7274    4.9135   </span></span>
<span><span class="co">## ln_cowspacre  5.2420 5.2455 3.9211  3.9085  4.2007      4.2037      4.6532    4.6566   </span></span>
<span><span class="co">## ocattlepacre  0.5565 0.5593 -0.1707 -0.1668 2.1366      2.1478      1.9219    1.9320   </span></span>
<span><span class="co">## pigspacre     2.4807 2.5393 2.2928  2.0802  2.8312      2.9010      3.1908    3.2703   </span></span>
<span><span class="co">## ln_pigspacre  2.3015 2.2724 2.0520  2.1893  2.5171      2.4839      2.8460    2.8081   </span></span>
<span><span class="co">## sheeppacre    1.0188 1.0630 0.8689  0.7387  1.7398      1.8187      1.4792    1.5470   </span></span>
<span><span class="co">## ln_sheeppacre 1.2930 1.2827 1.5156  1.5767  2.3708      2.3511      2.0374    2.0203   </span></span>
<span><span class="co">## townvillp     2.2759 2.2681 2.5475  2.5902  1.2148      1.2104      1.6275    1.6216   </span></span>
<span><span class="co">## carspcap      4.4927 4.4015 3.2247  3.5992  3.8897      3.8075      4.1826    4.0934   </span></span>
<span><span class="co">## radiopcap     0.3156 0.3153 1.2294  1.2348  0.5915      0.5909      0.7857    0.7849   </span></span>
<span><span class="co">## retailpcap    3.4985 3.4524 3.1303  3.3497  2.9291      2.8888      3.0346    2.9926   </span></span>
<span><span class="co">## psinglem30_34 2.7349 2.6895 2.3382  2.5519  2.7541      2.7065      2.7078    2.6605</span></span></code></pre>
<p>The values of the standard deviates agree with those in Table 4 in the original paper, with the exception of those for the proposed statistic with standardised weights under normality for all untransformed variables. We can see what has happened by substituting the weights constants for the standardised weights with those for unstandardised weights:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wc_unstd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spweights.constants.html">spweights.constants</a></span><span class="op">(</span><span class="va">lw_unstand</span><span class="op">)</span></span>
<span><span class="va">wrong_N_sqVI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="op">(</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">nn</span><span class="op">*</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">S1</span> <span class="op">-</span> <span class="va">wc_unstd</span><span class="op">$</span><span class="va">n</span><span class="op">*</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">S2</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">S0</span><span class="op">*</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">S0</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">nn</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">S0</span><span class="op">*</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">S0</span><span class="op">)</span><span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="va">wc_unstd</span><span class="op">$</span><span class="va">n</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">raw_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"^ln_"</span>, <span class="va">vars</span>, invert<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">I</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Prop_stdN</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">raw_data</span><span class="op">]</span></span>
<span><span class="va">EI</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Prop_stdN</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">[</span><span class="va">raw_data</span><span class="op">]</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">I</span> <span class="op">-</span> <span class="va">EI</span><span class="op">)</span><span class="op">/</span><span class="va">wrong_N_sqVI</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span><span class="op">[</span><span class="va">raw_data</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    pagval2_10   pagval10_50     pagval50p     cowspacre  ocattlepacre     pigspacre </span></span>
<span><span class="co">##        3.8836        1.4957        4.8276        4.6744        1.9003        3.1550 </span></span>
<span><span class="co">##    sheeppacre     townvillp      carspcap     radiopcap    retailpcap psinglem30_34 </span></span>
<span><span class="co">##        1.4627        1.6093        4.1357        0.7769        3.0006        2.6774</span></span></code></pre>
<p>Next, let us look at Table 5 in the original paper. Here we only tabulate the values of the measures themselves, and, since the expectation is constant for each measure, the square root of the variance of the measure under randomisation — extracting values calculated above:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MoranR"</span>, <span class="st">"GearyR"</span>, <span class="st">"Prop_unstdR"</span>, <span class="st">"Prop_stdR"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">estimate</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"I"</span>, <span class="st">"sigma_I"</span>, <span class="st">"C"</span>, <span class="st">"sigma_C"</span>, <span class="st">"unstd_r"</span>, <span class="st">"sigma_r"</span>, <span class="st">"std_r"</span>, <span class="st">"sigma_r"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               I       sigma_I C      sigma_C unstd_r sigma_r std_r  sigma_r</span></span>
<span><span class="co">## pagval2_10    0.4074  0.1158  0.3477 0.1672  0.4559  0.1456  0.5384 0.1440 </span></span>
<span><span class="co">## ln_pagval2_10 0.4444  0.1183  0.3825 0.1531  0.4930  0.1490  0.5680 0.1473 </span></span>
<span><span class="co">## pagval10_50   0.0877  0.1143  0.5840 0.1751  0.1577  0.1436  0.1818 0.1420 </span></span>
<span><span class="co">## pagval50p     0.5754  0.1221  0.3925 0.1287  0.6545  0.1539  0.6795 0.1522 </span></span>
<span><span class="co">## cowspacre     0.5749  0.1144  0.3418 0.1745  0.5764  0.1438  0.6566 0.1421 </span></span>
<span><span class="co">## ln_cowspacre  0.5803  0.1186  0.4071 0.1517  0.5858  0.1493  0.6456 0.1476 </span></span>
<span><span class="co">## ocattlepacre  0.0244  0.1181  1.0258 0.1547  0.2775  0.1486  0.2422 0.1469 </span></span>
<span><span class="co">## pigspacre     0.2527  0.1159  0.6533 0.1667  0.3812  0.1458  0.4296 0.1441 </span></span>
<span><span class="co">## ln_pigspacre  0.2314  0.1202  0.6897 0.1417  0.3343  0.1514  0.3787 0.1497 </span></span>
<span><span class="co">## sheeppacre    0.0792  0.1137  0.8686 0.1778  0.2182  0.1429  0.1768 0.1412 </span></span>
<span><span class="co">## ln_sheeppacre 0.1117  0.1196  0.7708 0.1453  0.3125  0.1506  0.2593 0.1489 </span></span>
<span><span class="co">## townvillp     0.2284  0.1191  0.6148 0.1487  0.1398  0.1499  0.1987 0.1482 </span></span>
<span><span class="co">## carspcap      0.4914  0.1211  0.5124 0.1355  0.5394  0.1526  0.5761 0.1509 </span></span>
<span><span class="co">## radiopcap     -0.0042 0.1188  0.8141 0.1505  0.0467  0.1495  0.0744 0.1478 </span></span>
<span><span class="co">## retailpcap    0.3734  0.1202  0.5267 0.1413  0.3959  0.1515  0.4066 0.1498 </span></span>
<span><span class="co">## psinglem30_34 0.2828  0.1207  0.6465 0.1385  0.3697  0.1520  0.3583 0.1503</span></span></code></pre>
<p>The values are as follows, and match the original with the exception of those for the initial version of Moran’s <span class="math inline">\(I\)</span> in the first two columns. If we write a function implementing equations 3 and 4:</p>
<p><span class="math display">\[I = \frac{\sum_{i=1}^{n}\sum_{j=i+1}^{n}w_{ij}(x_i-\bar{x})(x_j-\bar{x})}{\sum_{i=1}^{n}(x_i - \bar{x})^2}\]</span></p>
<p>where crucially the inner summation is over <span class="math inline">\(i+1 \ldots n\)</span>, not <span class="math inline">\(1 \ldots n\)</span>, we can reproduce the values of the measure shown in the original Table 5:</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oMoranf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">nb</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">x</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span>  <span class="va">glist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span><span class="va">ii</span> <span class="op">&lt;-</span> <span class="va">nb</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>; <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ii</span> <span class="op">&gt;</span> <span class="va">i</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">lw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">nb</span>, glist<span class="op">=</span><span class="va">glist</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span></span>
<span>  <span class="va">wz</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lag.html" class="external-link">lag</a></span><span class="op">(</span><span class="va">lw</span>, <span class="va">z</span><span class="op">)</span></span>
<span>  <span class="va">I</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">*</span><span class="va">wz</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">z</span><span class="op">*</span><span class="va">z</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">I</span></span>
<span><span class="op">}</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">oMoranf</span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nb<span class="op">=</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    pagval2_10 ln_pagval2_10   pagval10_50     pagval50p     cowspacre  ln_cowspacre </span></span>
<span><span class="co">##        0.8964        0.9776        0.1928        1.2660        1.2649        1.2766 </span></span>
<span><span class="co">##  ocattlepacre     pigspacre  ln_pigspacre    sheeppacre ln_sheeppacre     townvillp </span></span>
<span><span class="co">##        0.0536        0.5559        0.5091        0.1743        0.2458        0.5024 </span></span>
<span><span class="co">##      carspcap     radiopcap    retailpcap psinglem30_34 </span></span>
<span><span class="co">##        1.0811       -0.0093        0.8215        0.6222</span></span></code></pre>
<p>The variance term given in equation 7 in the original paper is for the case of normality, not randomisation; the reference on p. 28 to equation 38 on p. 26 does not permit the reproduction of the values in the second column of Table 5. The variance equation given as equation 1.35 by <span class="citation">Cliff and Ord (1973, 9)</span> does not do so either, so for the time being it is not possible to say how the tabulated values were computed. Note that since the standard deviances are reproduced correctly, and can be reproduced from the second column values using the measure and its expectance, it is just a matter of establishing which formula was used, but this has so far not proved possible.</p>
</div>
<div class="section level2">
<h2 id="simulating-measures-of-spatial-autocorrelation">Simulating measures of spatial autocorrelation<a class="anchor" aria-label="anchor" href="#simulating-measures-of-spatial-autocorrelation"></a>
</h2>
<p><span class="citation">Cliff and Ord (1969)</span> do not conduct simulation experiments, although their sequels do, notably <span class="citation">Cliff and Ord (1973)</span>, among many others. Simulation studies are necessarily more demanding computationally, especially if spatially autocorrelated variables are to be created, as in <span class="citation">Cliff and Ord (1973, 146–53)</span>. In the same book, they also report the use of permutation tests, also known as Monte Carlo or Hope hypothesis testing procedures <span class="citation">(Cliff and Ord 1973, 50–52)</span>. These procedures provided a way to examine the distribution of the statistic of interest by exchanging at random the observed values between observations, and then comparing the simulated distribution under the null hypothesis of no spatial patterning with the observed value of the statistic in question.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">MoranI.boot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">var</span>, <span class="va">i</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">var</span> <span class="op">&lt;-</span> <span class="va">var</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/moran.html">moran</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">var</span>, <span class="va">...</span><span class="op">)</span><span class="op">$</span><span class="va">I</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">Nsim</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">mle</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mle</span><span class="op">$</span><span class="va">mean</span>, <span class="va">mle</span><span class="op">$</span><span class="va">sd</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">f_bperm</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">nsim</span>, <span class="va">listw</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">boot</span><span class="op">(</span><span class="va">x</span>, statistic<span class="op">=</span><span class="va">MoranI.boot</span>, R<span class="op">=</span><span class="va">nsim</span>, sim<span class="op">=</span><span class="st">"permutation"</span>, listw<span class="op">=</span><span class="va">listw</span>,</span>
<span>    n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, S0<span class="op">=</span><span class="fu"><a href="../reference/spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">listw</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">f_bpara</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">nsim</span>, <span class="va">listw</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">boot</span><span class="op">(</span><span class="va">x</span>, statistic<span class="op">=</span><span class="va">MoranI.boot</span>, R<span class="op">=</span><span class="va">nsim</span>, sim<span class="op">=</span><span class="st">"parametric"</span>, ran.gen<span class="op">=</span><span class="va">Nsim</span>,</span>
<span>    mle<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, sd<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, listw<span class="op">=</span><span class="va">listw</span>, n<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    S0<span class="op">=</span><span class="fu"><a href="../reference/spweights.constants.html">Szero</a></span><span class="op">(</span><span class="va">listw</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">nsim</span> <span class="op">&lt;-</span> <span class="fl">4999</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
<p>First let us define a function <span><code>MoranI.boot</code></span> just to return the value of Moran’s <span class="math inline">\(I\)</span> for variable <span><code>var</code></span> and permutation index <span><code>i</code></span>, and a function <span><code>Nsim</code></span> to generate random samples from the variable of interest assuming Normality. To make it easier to process the variables in turn, we encapsulate calls to <span><code>boot</code></span> in wrapper functions <span><code>f_bperm</code></span> and <span><code>f_bpara</code></span>. Running 4999 simulations for each of 16 for three different weights specifications and both parametric and permutation bootstrap takes quite a lot of time.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">MoranNb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f_bpara</span><span class="op">(</span>x<span class="op">=</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nsim<span class="op">=</span><span class="va">nsim</span>, listw<span class="op">=</span><span class="va">nb_B</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">MoranRb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f_bperm</span><span class="op">(</span>x<span class="op">=</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nsim<span class="op">=</span><span class="va">nsim</span>, listw<span class="op">=</span><span class="va">nb_B</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_unstdNb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f_bpara</span><span class="op">(</span>x<span class="op">=</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nsim<span class="op">=</span><span class="va">nsim</span>, listw<span class="op">=</span><span class="va">lw_unstand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_unstdRb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f_bperm</span><span class="op">(</span>x<span class="op">=</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nsim<span class="op">=</span><span class="va">nsim</span>, listw<span class="op">=</span><span class="va">lw_unstand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_stdNb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f_bpara</span><span class="op">(</span>x<span class="op">=</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nsim<span class="op">=</span><span class="va">nsim</span>, listw<span class="op">=</span><span class="va">lw_std</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_stdRb</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">f_bperm</span><span class="op">(</span>x<span class="op">=</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, nsim<span class="op">=</span><span class="va">nsim</span>, listw<span class="op">=</span><span class="va">lw_std</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MoranNb"</span>, <span class="st">"MoranRb"</span>, <span class="st">"Prop_unstdNb"</span>, <span class="st">"Prop_unstdRb"</span>, <span class="st">"Prop_stdNb"</span>, <span class="st">"Prop_stdRb"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">t0</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/summarize-generics.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">y</span><span class="op">$</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/transpose.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">res</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MoranNb"</span>, <span class="st">"MoranRb"</span>, <span class="st">"Prop_unstdNb"</span>, <span class="st">"Prop_unstdRb"</span>, <span class="st">"Prop_stdNb"</span>, <span class="st">"Prop_stdRb"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span></code></pre></div>
<p>We collate the results to compare with the analytical standard deviates under Normality and randomisation, and see that in fact the differences are not at all large, as expressed by the median absolute difference between the tables. We can also see that inferences based on a one-sided <span class="math inline">\(\alpha=0.05\)</span> cut-off are the same for the analytical and bootstrap approaches. This indicates that we can, in general, rely on the analytical standard deviates, and that bootstrap methods will not help if assumptions underlying the measures are not met.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    pagval2_10 ln_pagval2_10   pagval10_50     pagval50p     cowspacre  ln_cowspacre </span></span>
<span><span class="co">##        0.8964        0.9776        0.1928        1.2660        1.2649        1.2766 </span></span>
<span><span class="co">##  ocattlepacre     pigspacre  ln_pigspacre    sheeppacre ln_sheeppacre     townvillp </span></span>
<span><span class="co">##        0.0536        0.5559        0.5091        0.1743        0.2458        0.5024 </span></span>
<span><span class="co">##      carspcap     radiopcap    retailpcap psinglem30_34 </span></span>
<span><span class="co">##        1.0811       -0.0093        0.8215        0.6222</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oores</span> <span class="op">&lt;-</span> <span class="va">ores</span> <span class="op">-</span> <span class="va">res</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">oores</span>, <span class="fl">2</span>, <span class="va">mad</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      MoranN      MoranR Prop_unstdN Prop_unstdR   Prop_stdN   Prop_stdR </span></span>
<span><span class="co">##   1.6470091   1.6241614   0.7681895   0.7170636   1.2615083   1.2723149</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha_0.05</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.05</span>, lower.tail<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">(</span><span class="va">res</span> <span class="op">&gt;=</span> <span class="va">alpha_0.05</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="va">ores</span> <span class="op">&gt;=</span> <span class="va">alpha_0.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<p>These assumptions affect the shape of the distribution of the measure in its tails; one possibility is to use a Saddlepoint approximation to find an equivalent to the analytical or bootstrap-based standard deviate for inference <span class="citation">(Tiefelsdorf 2002)</span>. The Saddlepoint approximation requires the eigenvalues of the weights matrix and iterative root-finding for global Moran’s <span class="math inline">\(I\)</span>, while for local Moran’s <span class="math inline">\(I_i\)</span>, analytical forms are known. Even with this computational burden, the Saddlepoint approximation for global Moran’s <span class="math inline">\(I\)</span> runs quite quickly. First we need to fit null linear models (only including an intercept) to the variables, then apply <span><code>lm.morantest.sad</code></span> to the fitted model objects:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lm_objs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"~1"</span><span class="op">)</span><span class="op">)</span>, data<span class="op">=</span><span class="va">eire_ge1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span><span class="va">MoranSad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lm_objs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/lm.morantest.sad.html">lm.morantest.sad</a></span><span class="op">(</span><span class="va">x</span>, listw<span class="op">=</span><span class="va">nb_B</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_unstdSad</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lm_objs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/lm.morantest.sad.html">lm.morantest.sad</a></span><span class="op">(</span><span class="va">x</span>, listw<span class="op">=</span><span class="va">lw_unstand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_stdSad</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lm_objs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/lm.morantest.sad.html">lm.morantest.sad</a></span><span class="op">(</span><span class="va">x</span>, listw<span class="op">=</span><span class="va">lw_std</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   0.063   0.000   0.064</span></span></code></pre>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MoranSad"</span>, <span class="st">"Prop_unstdSad"</span>, <span class="st">"Prop_stdSad"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="st">"statistic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span></code></pre></div>
<p>Although the analytical standard deviates (under Normality) are larger than those reached using the Saddlepoint approximation when measured by median absolute deviation, the differences do not lead to different inferences at this chosen cut-off. This reflects the fact that the shape of the distribution is very sensitive to small <span class="math inline">\(n\)</span>, but for moderate <span class="math inline">\(n\)</span> and global Moran’s <span class="math inline">\(I\)</span>, the effects are seen only further out in the tails. The consequences for local Moran’s <span class="math inline">\(I_i\)</span> are much stronger, because the clique of neighbours of each observation is typically very small. It is perhaps of interest that the differences are much smaller for the case of general weights than for unstandardised binary weights.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               MoranSad Prop_unstdSad Prop_stdSad</span></span>
<span><span class="co">## pagval2_10    3.2903   3.1711        3.8283     </span></span>
<span><span class="co">## ln_pagval2_10 3.5346   3.3982        4.0441     </span></span>
<span><span class="co">## pagval10_50   1.0883   1.3219        1.4791     </span></span>
<span><span class="co">## pagval50p     4.4402   4.4258        4.9377     </span></span>
<span><span class="co">## cowspacre     4.4366   3.9164        4.7406     </span></span>
<span><span class="co">## ln_cowspacre  4.4758   3.9760        4.6493     </span></span>
<span><span class="co">## ocattlepacre  0.6030   2.0748        1.8642     </span></span>
<span><span class="co">## pigspacre     2.2611   2.7154        3.0775     </span></span>
<span><span class="co">## ln_pigspacre  2.1158   2.4271        2.7417     </span></span>
<span><span class="co">## sheeppacre    1.0250   1.7040        1.4476     </span></span>
<span><span class="co">## ln_sheeppacre 1.2669   2.2921        1.9731     </span></span>
<span><span class="co">## townvillp     2.0949   1.2079        1.5872     </span></span>
<span><span class="co">## carspcap      3.8500   3.6840        4.1044     </span></span>
<span><span class="co">## radiopcap     0.3750   0.6094        0.7906     </span></span>
<span><span class="co">## retailpcap    3.0663   2.8049        2.9245     </span></span>
<span><span class="co">## psinglem30_34 2.4649   2.6449        2.6089</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oores</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">-</span> <span class="va">ores</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">oores</span>, <span class="fl">2</span>, <span class="va">mad</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      MoranSad Prop_unstdSad   Prop_stdSad </span></span>
<span><span class="co">##    0.37142684    0.10779060    0.05650183</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">(</span><span class="va">res</span> <span class="op">&gt;=</span> <span class="va">alpha_0.05</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="va">ores</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">alpha_0.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>In addition we could choose to use the exact distribution of Moran’s <span class="math inline">\(I\)</span>, as described by <span class="citation">Tiefelsdorf (2000)</span>; its implementation is covered in <span class="citation">R. S. Bivand, Müller, and Reder (2009)</span>. The global case also needs the eigenvalues of the weights matrix, and the solution of a numerical integration function, but for these cases, the timings are quite acceptable.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span> </span>
<span><span class="va">MoranEx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lm_objs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/lm.morantest.exact.html">lm.morantest.exact</a></span><span class="op">(</span><span class="va">x</span>, listw<span class="op">=</span><span class="va">nb_B</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_unstdEx</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lm_objs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/lm.morantest.exact.html">lm.morantest.exact</a></span><span class="op">(</span><span class="va">x</span>, listw<span class="op">=</span><span class="va">lw_unstand</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Prop_stdEx</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">lm_objs</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/lm.morantest.exact.html">lm.morantest.exact</a></span><span class="op">(</span><span class="va">x</span>, listw<span class="op">=</span><span class="va">lw_std</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    user  system elapsed </span></span>
<span><span class="co">##   0.081   0.000   0.081</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MoranEx"</span>, <span class="st">"Prop_unstdEx"</span>, <span class="st">"Prop_stdEx"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"[["</span>, <span class="st">"statistic"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span></code></pre></div>
<p>The output is comparable with that of the Saddlepoint approximation, and the inferences drawn here are the same for the chosen cut-off as for the analytical standard deviates calculated under Normality.</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               MoranEx Prop_unstdEx Prop_stdEx</span></span>
<span><span class="co">## pagval2_10    3.2895  3.1660       3.8261    </span></span>
<span><span class="co">## ln_pagval2_10 3.5384  3.3979       4.0430    </span></span>
<span><span class="co">## pagval10_50   1.0798  1.3131       1.4745    </span></span>
<span><span class="co">## pagval50p     4.4568  4.4430       4.9446    </span></span>
<span><span class="co">## cowspacre     4.4532  3.9268       4.7453    </span></span>
<span><span class="co">## ln_cowspacre  4.4928  3.9875       4.6531    </span></span>
<span><span class="co">## ocattlepacre  0.5967  2.0611       1.8596    </span></span>
<span><span class="co">## pigspacre     2.2486  2.7033       3.0740    </span></span>
<span><span class="co">## ln_pigspacre  2.1031  2.4131       2.7380    </span></span>
<span><span class="co">## sheeppacre    1.0168  1.6924       1.4430    </span></span>
<span><span class="co">## ln_sheeppacre 1.2575  2.2779       1.9685    </span></span>
<span><span class="co">## townvillp     2.0822  1.1999       1.5826    </span></span>
<span><span class="co">## carspcap      3.8593  3.6899       4.1037    </span></span>
<span><span class="co">## radiopcap     0.3696  0.6054       0.7873    </span></span>
<span><span class="co">## retailpcap    3.0616  2.7938       2.9210    </span></span>
<span><span class="co">## psinglem30_34 2.4533  2.6321       2.6050</span></span></code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oores</span> <span class="op">&lt;-</span> <span class="va">res</span> <span class="op">-</span> <span class="va">ores</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">oores</span>, <span class="fl">2</span>, <span class="va">mad</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      MoranEx Prop_unstdEx   Prop_stdEx </span></span>
<span><span class="co">##   0.37187539   0.09751723   0.05419300</span></span></code></pre>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="op">(</span><span class="va">res</span> <span class="op">&gt;=</span> <span class="va">alpha_0.05</span><span class="op">)</span> <span class="op">==</span> <span class="op">(</span><span class="va">ores</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span> <span class="op">&gt;=</span> <span class="va">alpha_0.05</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p><span class="citation">Li, Calder, and Cressie (2007)</span> take up the challenge in <span class="citation">Cliff and Ord (1969, 31)</span>, to try to give the statistic a bounded fixed range. Their APLE measure is intended to approximate the spatial dependence parameter of a simultaneous autoregressive model better than Moran’s <span class="math inline">\(I\)</span>, and re-scales the measure by a function of the eigenvalues of the spatial weights matrix. APLE requires the use of row standardised weights.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">vars</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/pkg/terra/man/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">eire_ge1</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>, scale<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nb_W</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nb2listw.html">nb2listw</a></span><span class="op">(</span><span class="va">lw_unstand</span><span class="op">$</span><span class="va">neighbours</span>, style<span class="op">=</span><span class="st">"W"</span><span class="op">)</span></span>
<span><span class="va">pre</span> <span class="op">&lt;-</span> <span class="fu">spatialreg</span><span class="fu">:::</span><span class="fu">preAple</span><span class="op">(</span><span class="fl">0</span>, listw<span class="op">=</span><span class="va">nb_W</span><span class="op">)</span></span>
<span><span class="va">MoranAPLE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">vars_scaled</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">spatialreg</span><span class="fu">:::</span><span class="fu">inAple</span><span class="op">(</span><span class="va">x</span>, <span class="va">pre</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pre</span> <span class="op">&lt;-</span> <span class="fu">spatialreg</span><span class="fu">:::</span><span class="fu">preAple</span><span class="op">(</span><span class="fl">0</span>, listw<span class="op">=</span><span class="va">lw_std</span>, override_similarity_check<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">Prop_stdAPLE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">vars_scaled</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">spatialreg</span><span class="fu">:::</span><span class="fu">inAple</span><span class="op">(</span><span class="va">x</span>, <span class="va">pre</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">MoranAPLE</span>, <span class="va">Prop_stdAPLE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"APLE W"</span>, <span class="st">"APLE Gstd"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">vars</span></span></code></pre></div>
<p>In order to save time, we use the two internal functions <span><code>spatialreg:::preAple</code></span> and <span><code>spatialreg:::inAple</code></span>, since for each definition of spatial weights, the same eigenvalue calculations need to be made. The notation using the <span><code>:::</code></span> operator says that the function with named after the operator is to be found in the namespace of the package named before the operator. The APLE values repeat the pattern that we have already seen — for some variables, the measured autocorrelation is very similar irrespective of spatial weights definition, while for others, the change in the definition from binary to general does make a difference.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formatc.html" class="external-link">formatC</a></span><span class="op">(</span><span class="va">res</span>, format<span class="op">=</span><span class="st">"f"</span>, digits<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, quote<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               APLE W APLE Gstd</span></span>
<span><span class="co">## pagval2_10    0.7702 0.6628   </span></span>
<span><span class="co">## ln_pagval2_10 0.7615 0.6655   </span></span>
<span><span class="co">## pagval10_50   0.3954 0.3446   </span></span>
<span><span class="co">## pagval50p     0.7519 0.7313   </span></span>
<span><span class="co">## cowspacre     0.8329 0.7408   </span></span>
<span><span class="co">## ln_cowspacre  0.8148 0.7487   </span></span>
<span><span class="co">## ocattlepacre  0.1468 0.4092   </span></span>
<span><span class="co">## pigspacre     0.6227 0.6205   </span></span>
<span><span class="co">## ln_pigspacre  0.5582 0.5887   </span></span>
<span><span class="co">## sheeppacre    0.1594 0.2841   </span></span>
<span><span class="co">## ln_sheeppacre 0.2046 0.4550   </span></span>
<span><span class="co">## townvillp     0.3442 0.2644   </span></span>
<span><span class="co">## carspcap      0.7140 0.6166   </span></span>
<span><span class="co">## radiopcap     0.0083 0.1376   </span></span>
<span><span class="co">## retailpcap    0.6376 0.5307   </span></span>
<span><span class="co">## psinglem30_34 0.4094 0.4889</span></span></code></pre>
<div class="figure">
<img src="CO69_files/figure-html/unnamed-chunk-41-1.png" alt="Three contrasted spatial weights definitions" width="700"><p class="caption">
Three contrasted spatial weights definitions
</p>
</div>
<img src="CO69_files/figure-html/unnamed-chunk-42-1.png" width="700">
</div>
<div class="section level2">
<h2 id="odds-and-ends-ldots">Odds and ends <span class="math inline">\(\ldots\)</span><a class="anchor" aria-label="anchor" href="#odds-and-ends-ldots"></a>
</h2>
<p>The differences found in the case of a few variables in inference using the original binary weights, and the general weights proposed by <span class="citation">Cliff and Ord (1969)</span> are necessarily related to the the weights thenselves. Figures <span class="math display">\[plot\_wts\]</span> and <span class="math display">\[plot\_map\]</span> show the values of the weights in sparse matrix form, and the sums of weights by county where these sums are not identical by design. In the case of binary weights, the matrix entries are equal, but the sums up-weight counties with many neighbours.</p>
<p>General weights up-weight counties that are close to each other, have more neighbours, and share larger boundary proportions (an asymmetric relationship). There is a further impact of using boundary proportions, in that the boundary between the county and the exterior is subtracted, thus boosting the weights between edge counties and their neighbours, even if there are few of them. Standardised general weights up-weight further up-weight counties with few neighbours, chiefly those on the edges of the study area.</p>
<p>With a small data set, here with <span class="math inline">\(n=25\)</span>, it is very possible that edge and other configuration effects are relatively strong, and may impact inference in different ways. The issue of egde effects has not really been satisfactorily resolved, and should be kept in mind in analyses of data sets of this size and shape.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-bivandetal:09" class="csl-entry">
Bivand, R. S., W. Müller, and M. Reder. 2009. <span>“Power Calculations for Global and Local <span>M</span>oran’s <span><span class="math inline">\(I\)</span></span>.”</span> <em>Computational Statistics and Data Analysis</em> 53: 2859–72.
</div>
<div id="ref-bivandetal:08" class="csl-entry">
Bivand, Roger S., Edzer J. Pebesma, and Virgilio Gómez-Rubio. 2008. <em>Applied Spatial Data Analysis with <span>R</span></em>. New York: Springer.
</div>
<div id="ref-cliff+ord:69" class="csl-entry">
Cliff, A. D., and J. K. Ord. 1969. <span>“The Problem of Spatial Autocorrelation.”</span> In <em>London Papers in Regional Science 1, Studies in Regional Science</em>, edited by A. J. Scott, 25–55. London: Pion.
</div>
<div id="ref-cliff+ord:73" class="csl-entry">
———. 1973. <em>Spatial Autocorrelation</em>. London: Pion.
</div>
<div id="ref-geary:54" class="csl-entry">
Geary, R. C. 1954. <span>“The Contiguity Ratio and Statistical Mapping.”</span> <em>The Incorporated Statistician</em> 5: 115–45.
</div>
<div id="ref-joanes+gill:98" class="csl-entry">
Joanes, D. N., and C. A. Gill. 1998. <span>“Comparing Measures of Sample Skewness and Kurtosis.”</span> <em>The Statistician</em> 47: 183–89.
</div>
<div id="ref-lietal:07" class="csl-entry">
Li, Hongfei, Catherine A. Calder, and Noel Cressie. 2007. <span>“Beyond <span class="nocase">Moran’s</span> <span>I</span>: Testing for Spatial Dependence Based on the Spatial Autoregressive Model.”</span> <em>Geographical Analysis</em> 39: 357–75.
</div>
<div id="ref-moran:50" class="csl-entry">
Moran, P. A. P. 1950. <span>“Notes on Continuous Stochastic Phenomena.”</span> <em>Biometrika</em> 37: 17–23.
</div>
<div id="ref-tiefelsdorf:00" class="csl-entry">
Tiefelsdorf, M. 2000. <em>Modelling Spatial Processes: The Identification and Analysis of Spatial Relationships in Regression Residuals by Means of <span>Moran</span>’s <span><span class="math inline">\(I\)</span></span></em>. Berlin: Springer.
</div>
<div id="ref-tiefelsdorf:02" class="csl-entry">
———. 2002. <span>“The Saddlepoint Approximation of <span>Moran</span>’s <span>I</span> and Local <span>Moran</span>’s <span class="math inline">\({I}_i\)</span> Reference Distributions and Their Numerical Evaluation.”</span> <em>Geographical Analysis</em> 34: 187–206.
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>cropped scans of tables are available from <a href="https://github.com/rsbivand/CO69" class="external-link uri">https://github.com/rsbivand/CO69</a>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
