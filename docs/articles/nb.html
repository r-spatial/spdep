<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating Neighbours • spdep</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating Neighbours">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">spdep</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-6</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/CO69.html">“The Problem of Spatial Autocorrelation:” forty years on</a></li>
    <li><a class="dropdown-item" href="../articles/nb_sf.html">Creating Neighbours using sf objects</a></li>
    <li><a class="dropdown-item" href="../articles/nb.html">Creating Neighbours</a></li>
    <li><a class="dropdown-item" href="../articles/sids.html">Introduction to the North Carolina SIDS data set (re-revised)</a></li>
    <li><a class="dropdown-item" href="../articles/subgraphs.html">No-neighbour observation and subgraph handling</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-spatial/spdep/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Creating Neighbours</h1>
                        <h4 data-toc-skip class="author">Roger
Bivand</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatial/spdep/blob/HEAD/vignettes/nb.Rmd" class="external-link"><code>vignettes/nb.Rmd</code></a></small>
      <div class="d-none name"><code>nb.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="creating-neighbours">Creating Neighbours<a class="anchor" aria-label="anchor" href="#creating-neighbours"></a>
</h2>
<p>This vignette formed pp. 239–251 of the first edition of Bivand, R.
S., Pebesma, E. and Gómez-Rubio V. (2008) <em>Applied Spatial Data
Analysis with R</em>, Springer-Verlag, New York. It was retired from the
second edition (2013) to accommodate material on other topics, and is
made available in this form with the understanding of the
publishers.</p>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>Creating spatial weights is a necessary step in using areal data,
perhaps just to check that there is no remaining spatial patterning in
residuals. The first step is to define which relationships between
observations are to be given a non-zero weight, that is to choose the
neighbour criterion to be used; the second is to assign weights to the
identified neighbour links.</p>
<p>The 281 census tract data set for eight central New York State
counties featured prominently in <span class="citation">(Waller and
Gotway 2004)</span> will be used in many of the examples, supplemented
with tract boundaries derived from TIGER 1992 and distributed by
SEDAC/CIESIN. The boundaries have been projected from geographical
coordinates to UTM zone~18. This file is not identical with the
boundaries used in the original source, but is very close and may be
re-distributed, unlike the version used in the book. Starting from the
census tract queen contiguities, where all touching polygons are
neighbours, used in <span class="citation">(Waller and Gotway
2004)</span> and provided as a DBF file on their website, a GAL format
file has been created and read into R.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/spdep/" class="external-link">spdep</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: spData</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: sf</span></span></code></pre>
<pre><code><span><span class="co">## Linking to GEOS 3.13.0, GDAL 3.9.2, PROJ 9.5.0; sf_use_s2() is TRUE</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/packageDescription.html" class="external-link">packageVersion</a></span><span class="op">(</span><span class="st">"spData"</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="st">"2.3.2"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">NY8a</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/NY8_utm18.gpkg"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">NY8a</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"shapes/NY8_bna_utm18.gpkg"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">NY8a</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"EPSG:32618"</span></span>
<span>    <span class="va">NY8a</span><span class="op">$</span><span class="va">Cases</span> <span class="op">&lt;-</span> <span class="va">NY8a</span><span class="op">$</span><span class="va">TRACTCAS</span></span>
<span><span class="op">}</span></span></code></pre></div>
<pre><code><span><span class="co">## Reading layer `NY8_utm18' from data source </span></span>
<span><span class="co">##   `/home/rsb/lib/r_libs/spData/shapes/NY8_utm18.gpkg' using driver `GPKG'</span></span>
<span><span class="co">## Simple feature collection with 281 features and 17 fields</span></span>
<span><span class="co">## Geometry type: POLYGON</span></span>
<span><span class="co">## Dimension:     XY</span></span>
<span><span class="co">## Bounding box:  xmin: 358241.9 ymin: 4649755 xmax: 480393.1 ymax: 4808545</span></span>
<span><span class="co">## Projected CRS: WGS 84 / UTM zone 18N</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">NY8</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">NY8a</span>, <span class="st">"Spatial"</span><span class="op">)</span></span>
<span><span class="va">NY_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read.gal.html">read.gal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"weights/NY_nb.gal"</span>, package<span class="op">=</span><span class="st">"spData"</span><span class="op">)</span>, region.id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">NY8</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>For the sake of simplicity in showing how to create neighbour
objects, we work on a subset of the map consisting of the census tracts
within Syracuse, although the same principles apply to the full data
set. We retrieve the part of the neighbour list in Syracuse using the
<code>subset</code> method.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Syracuse</span> <span class="op">&lt;-</span> <span class="va">NY8</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NY8</span><span class="op">$</span><span class="va">AREANAME</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">NY8</span><span class="op">$</span><span class="va">AREANAME</span> <span class="op">==</span> <span class="st">"Syracuse city"</span>,<span class="op">]</span></span>
<span><span class="va">Sy0_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">NY_nb</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">NY8</span><span class="op">$</span><span class="va">AREANAME</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">NY8</span><span class="op">$</span><span class="va">AREANAME</span> <span class="op">==</span> <span class="st">"Syracuse city"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Sy0_nb</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 63 </span></span>
<span><span class="co">## Number of nonzero links: 346 </span></span>
<span><span class="co">## Percentage nonzero weights: 8.717561 </span></span>
<span><span class="co">## Average number of links: 5.492063 </span></span>
<span><span class="co">## Link number distribution:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  1  2  3  4  5  6  7  8  9 </span></span>
<span><span class="co">##  1  1  5  9 14 17  9  6  1 </span></span>
<span><span class="co">## 1 least connected region:</span></span>
<span><span class="co">## 164 with 1 link</span></span>
<span><span class="co">## 1 most connected region:</span></span>
<span><span class="co">## 136 with 9 links</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="creating-contiguity-neighbours">Creating Contiguity Neighbours<a class="anchor" aria-label="anchor" href="#creating-contiguity-neighbours"></a>
</h3>
<p>We can create a copy of the same neighbours object for polygon
contiguities using the <code><a href="../reference/poly2nb.html">poly2nb()</a></code> function in
<strong>spdep</strong>. It takes an object extending the
<code>SpatialPolygons</code> class as its first argument, and using
heuristics identifies polygons sharing boundary points as neighbours. It
also has a <code>snap=</code> argument, to allow the shared boundary
points to be a short distance from one another.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "SpatialPolygonsDataFrame"</span></span>
<span><span class="co">## attr(,"package")</span></span>
<span><span class="co">## [1] "sp"</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy1_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">Sy0_nb</span>, <span class="va">Sy1_nb</span>, check.attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>As we can see, creating the contiguity neighbours from the
<code>Syracuse</code> object reproduces the neighbours from <span class="citation">(Waller and Gotway 2004)</span>. Careful examination of
the next figure shows, however, that the graph of neighbours is not
planar, since some neighbour links cross each other. By default, the
contiguity condition is met when at least one point on the boundary of
one polygon is within the snap distance of at least one point of its
neighbour. This relationship is given by the argument
<code>queen=TRUE</code> by analogy with movements on a chessboard. So
when three or more polygons meet at a single point, they all meet the
contiguity condition, giving rise to crossed links. If
<code>queen=FALSE</code>, at least two boundary points must be within
the snap distance of each other, with the conventional name of a `rook’
relationship. The figure shows the crossed line differences that arise
when polygons touch only at a single point, compared to the stricter
rook criterion.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy2_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/poly2nb.html">poly2nb</a></span><span class="op">(</span><span class="va">Syracuse</span>, queen<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">Sy0_nb</span>, <span class="va">Sy2_nb</span>, check.attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] FALSE</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oopar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy0_nb</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="fl">19</span>, cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"a)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy0_nb</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="fl">19</span>, cex<span class="op">=</span><span class="fl">0.6</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="../reference/diffnb.html">diffnb</a></span><span class="op">(</span><span class="va">Sy0_nb</span>, <span class="va">Sy2_nb</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span>,</span>
<span>  add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span>, cex<span class="op">=</span><span class="fl">0.6</span>, lwd<span class="op">=</span><span class="fl">2</span>, col<span class="op">=</span><span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"b)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oopar</span><span class="op">)</span></span></code></pre></div>
<p>a: Queen-style census tract contiguities, Syracuse; b: Rook-style
contiguity differences shown as thicker orange lines</p>
<p>If we have access to a GIS such as GRASS or ArcGIS, we can export the
<code>SpatialPolygonsDataFrame</code> object and use the topology engine
in the GIS to find contiguities in the graph of polygon edges - a shared
edge will yield the same output as the rook relationship.</p>
<p>This procedure does, however, depend on the topology of the set of
polygons being clean, which holds for this subset, but not for the full
eight-county data set. Not infrequently, there are small artefacts, such
as slivers where boundary lines intersect or diverge by distances that
cannot be seen on plots, but which require intervention to keep the
geometries and data correctly associated. When these geometrical
artefacts are present, the topology is not clean, because unambiguous
shared polygon boundaries cannot be found in all cases; artefacts
typically arise when data collected for one purpose are combined with
other data or used for another purpose. Topologies are usually cleaned
in a GIS by
<code>snapping' vertices closer than a threshold distance together, removing artefacts -- for example, snapping across a river channel where the correct boundary is the median line but the input polygons stop at the channel banks on each side. The</code>poly2nb()<code>function does have a</code>snap`
argument, which may also be used when input data possess geometrical
artefacts.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rsbivand.github.io/rgrass/" class="external-link">rgrass</a></span><span class="op">)</span></span>
<span><span class="va">v</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">SG</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span>, crs<span class="op">=</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">v</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/rgrass/reference/initGRASS.html" class="external-link">initGRASS</a></span><span class="op">(</span><span class="st">"/home/rsb/topics/grass/g840/grass84"</span>, <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, SG<span class="op">=</span><span class="va">SG</span>, override<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rsbivand.github.io/rgrass/reference/readVECT.html" class="external-link">write_VECT</a></span><span class="op">(</span><span class="va">v</span>, <span class="st">"SY0"</span>, flags<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"o"</span>, <span class="st">"overwrite"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">contig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsbivand.github.io/rgrass/reference/readVECT.html" class="external-link">vect2neigh</a></span><span class="op">(</span><span class="st">"SY0"</span><span class="op">)</span></span>
<span><span class="va">Sy3_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/listw2sn.html">sn2listw</a></span><span class="op">(</span><span class="va">contig</span>, style<span class="op">=</span><span class="st">"B"</span><span class="op">)</span><span class="op">$</span><span class="va">neighbours</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="va">Sy3_nb</span>, <span class="va">Sy2_nb</span>, check.attributes<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## [1] TRUE</span></span></code></pre></div>
<p>Similar approaches may also be used to read ArcGIS coverage data by
tallying the left neighbour and right neighbour arc indices with the
polygons in the data set, using either <strong>RArcInfo</strong> or
<strong>rgdal</strong>.</p>
<p>In our Syracuse case, there are no exclaves or
<code>islands' belonging to the data set, but not sharing boundary points within the snap distance. If the number of polygons is moderate, the missing neighbour links may be added interactively using the</code>edit()<code>method for</code>nb`
objects, and displaying the polygon background. The same method may be
used for removing links which, although contiguity exists, may be
considered void, such as across a mountain range.</p>
</div>
<div class="section level3">
<h3 id="creating-graph-based-neighbours">Creating Graph-Based Neighbours<a class="anchor" aria-label="anchor" href="#creating-graph-based-neighbours"></a>
</h3>
<p>Continuing with irregularly located areal entities, it is possible to
choose a point to represent the polygon-support entities. This is often
the polygon centroid, which is not the average of the coordinates in
each dimension, but takes proper care to weight the component triangles
of the polygon by area. It is also possible to use other points, or if
data are available, construct, for example population-weighted
centroids. Once representative points are available, the criteria for
neighbourhood can be extended from just contiguity to include graph
measures, distance thresholds, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-nearest
neighbours.</p>
<p>The most direct graph representation of neighbours is to make a
Delaunay triangulation of the points, shown in the first panel in the
figure. The neighbour relationships are defined by the triangulation,
which extends outwards to the convex hull of the points and which is
planar. Note that graph-based representations construct the interpoint
relationships based on Euclidean distance, with no option to use Great
Circle distances for geographical coordinates. Because it joins distant
points around the convex hull, it may be worthwhile to thin the
triangulation as a Sphere of Influence (SOI) graph, removing links that
are relatively long. Points are SOI neighbours if circles centred on the
points, of radius equal to the points’ nearest neighbour distances,
intersect in two places <span class="citation">(Avis and Horton
1985)</span>. Functions for graph-based neighbours were kindly
contributed by Nicholas Lewin-Koh.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span></span>
<span><span class="va">IDs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/as.html" class="external-link">as</a></span><span class="op">(</span><span class="va">Syracuse</span>, <span class="st">"data.frame"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#FIXME library(tripack)</span></span>
<span><span class="va">Sy4_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tri2nb.html">tri2nb</a></span><span class="op">(</span><span class="va">coords</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/dbscan" class="external-link">dbscan</a></span>, quietly<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">Sy5_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graphneigh.html">graph2nb</a></span><span class="op">(</span><span class="fu"><a href="../reference/graphneigh.html">soi.graph</a></span><span class="op">(</span><span class="va">Sy4_nb</span>, <span class="va">coords</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="va">Sy5_nb</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dbscan'</span></span></code></pre>
<pre><code><span><span class="co">## The following object is masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     as.dendrogram</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy6_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graphneigh.html">graph2nb</a></span><span class="op">(</span><span class="fu"><a href="../reference/graphneigh.html">gabrielneigh</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="va">Sy7_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/graphneigh.html">graph2nb</a></span><span class="op">(</span><span class="fu"><a href="../reference/graphneigh.html">relativeneigh</a></span><span class="op">(</span><span class="va">coords</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oopar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy4_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"a)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">Sy5_nb</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy5_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"b)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy6_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"c)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy7_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"d)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oopar</span><span class="op">)</span></span></code></pre></div>
<p>a: Delauney triangulation neighbours; b: Sphere of influence
neighbours (if available); c: Gabriel graph neighbours; d: Relative
graph neighbours</p>
<p>Delaunay triangulation neighbours and SOI neighbours are symmetric by
design – if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
is a neighbour of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>,
then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>
is a neighbour of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>.
The Gabriel graph is also a subgraph of the Delaunay triangulation,
retaining a different set of neighbours <span class="citation">(Matula
and Sokal 1980)</span>. It does not, however, guarantee symmetry; the
same applies to Relative graph neighbours <span class="citation">(Toussaint 1980)</span>. The <code><a href="../reference/graphneigh.html">graph2nb()</a></code>
function takes a <code>sym</code> argument to insert links to restore
symmetry, but the graphs then no longer exactly fulfil their neighbour
criteria. All the graph-based neighbour schemes always ensure that all
the points will have at least one neighbour. Subgraphs of the full
triangulation may also have more than one graph after trimming. The
functions <code><a href="../reference/testnb.html">is.symmetric.nb()</a></code> can be used to check for
symmetry, with argument <code>force=TRUE</code> if the symmetry
attribute is to be overridden, and <code><a href="../reference/compon.html">n.comp.nb()</a></code> reports the
number of graph components and~the components to which points belong
(after enforcing symmetry, because the algorithm assumes that the graph
is not directed). When there are more than one graph component, the
matrix representation of the spatial weights can become block-diagonal
if observations are appropriately sorted.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Triangulation<span class="op">=</span><span class="va">Sy4_nb</span>, Gabriel<span class="op">=</span><span class="va">Sy6_nb</span>,</span>
<span>  Relative<span class="op">=</span><span class="va">Sy7_nb</span><span class="op">)</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">Sy5_nb</span><span class="op">)</span><span class="op">)</span> <span class="va">nb_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>SOI<span class="op">=</span><span class="va">Sy5_nb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/testnb.html">is.symmetric.nb</a></span><span class="op">(</span><span class="va">x</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>, force<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Triangulation       Gabriel      Relative           SOI </span></span>
<span><span class="co">##          TRUE         FALSE         FALSE          TRUE</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/compon.html">n.comp.nb</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">nc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Triangulation       Gabriel      Relative           SOI </span></span>
<span><span class="co">##             1             1             1             1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="distance-based-neighbours">Distance-Based Neighbours<a class="anchor" aria-label="anchor" href="#distance-based-neighbours"></a>
</h3>
<p>An alternative method is to choose the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
nearest points as neighbours – this adapts across the study area, taking
account of differences in the densities of areal entities. Naturally, in
the overwhelming majority of cases, it leads to asymmetric neighbours,
but will ensure that all areas have
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
neighbours. The <code><a href="../reference/knearneigh.html">knearneigh()</a></code> function returns an
intermediate form converted to an <code>nb</code> object by
<code><a href="../reference/knn2nb.html">knn2nb()</a></code>; <code><a href="../reference/knearneigh.html">knearneigh()</a></code> can also take a
<code>longlat=</code> argument to handle geographical coordinates.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy8_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="../reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in knn2nb(knearneigh(coords, k = 1), row.names = IDs): neighbour object</span></span>
<span><span class="co">## has 15 sub-graphs</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy9_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="../reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="va">Sy10_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/knn2nb.html">knn2nb</a></span><span class="op">(</span><span class="fu"><a href="../reference/knearneigh.html">knearneigh</a></span><span class="op">(</span><span class="va">coords</span>, k<span class="op">=</span><span class="fl">4</span><span class="op">)</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="va">nb_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>k1<span class="op">=</span><span class="va">Sy8_nb</span>, k2<span class="op">=</span><span class="va">Sy9_nb</span>, k4<span class="op">=</span><span class="va">Sy10_nb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/testnb.html">is.symmetric.nb</a></span><span class="op">(</span><span class="va">x</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>, force<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    k1    k2    k4 </span></span>
<span><span class="co">## FALSE FALSE FALSE</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/compon.html">n.comp.nb</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">nc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## k1 k2 k4 </span></span>
<span><span class="co">## 15  1  1</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oopar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy8_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"a)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy9_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"b)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy10_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"c)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oopar</span><span class="op">)</span></span></code></pre></div>
<p>a:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math>
neighbours; b:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">k=2</annotation></semantics></math>
neighbours; c:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">k=4</annotation></semantics></math>
neighbours</p>
<p>The figure shows the neighbour relationships for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">k= 1, 2, 4</annotation></semantics></math>,
with many components for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math>.
If need be,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-nearest
neighbour objects can be made symmetrical using the
<code><a href="../reference/testnb.html">make.sym.nb()</a></code> function. The
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math>
object is also useful in finding the minimum distance at which all areas
have a distance-based neighbour. Using the <code><a href="../reference/nbdists.html">nbdists()</a></code>
function, we can calculate a list of vectors of distances corresponding
to the neighbour object, here for first nearest neighbours. The greatest
value will be the minimum distance needed to make sure that all the
areas are linked to at least one neighbour. The
<code><a href="../reference/dnearneigh.html">dnearneigh()</a></code> function is used to find neighbours with an
interpoint distance, with arguments <code>d1</code> and <code>d2</code>
setting the lower and upper distance bounds; it can also take a
<code>longlat</code> argument to handle geographical coordinates.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">Sy8_nb</span>, <span class="va">coords</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dsts</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##   395.7   587.3   700.1   760.4   906.1  1544.6</span></span></code></pre>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">max_1nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">dsts</span><span class="op">)</span></span>
<span><span class="va">max_1nn</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1544.615</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy11_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">coords</span>, d1<span class="op">=</span><span class="fl">0</span>, d2<span class="op">=</span><span class="fl">0.75</span><span class="op">*</span><span class="va">max_1nn</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in dnearneigh(coords, d1 = 0, d2 = 0.75 * max_1nn, row.names = IDs):</span></span>
<span><span class="co">## neighbour object has 4 sub-graphs</span></span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy12_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">coords</span>, d1<span class="op">=</span><span class="fl">0</span>, d2<span class="op">=</span><span class="fl">1</span><span class="op">*</span><span class="va">max_1nn</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="va">Sy13_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="va">coords</span>, d1<span class="op">=</span><span class="fl">0</span>, d2<span class="op">=</span><span class="fl">1.5</span><span class="op">*</span><span class="va">max_1nn</span>, row.names<span class="op">=</span><span class="va">IDs</span><span class="op">)</span></span>
<span><span class="va">nb_l</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>d1<span class="op">=</span><span class="va">Sy11_nb</span>, d2<span class="op">=</span><span class="va">Sy12_nb</span>, d3<span class="op">=</span><span class="va">Sy13_nb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/testnb.html">is.symmetric.nb</a></span><span class="op">(</span><span class="va">x</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>, force<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   d1   d2   d3 </span></span>
<span><span class="co">## TRUE TRUE TRUE</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/compon.html">n.comp.nb</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">nc</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## d1 d2 d3 </span></span>
<span><span class="co">##  4  1  1</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">oopar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span>, mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy11_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"a)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy12_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"b)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Syracuse</span>, border<span class="op">=</span><span class="st">"grey60"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Sy13_nb</span>, <span class="va">coords</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/text.html" class="external-link">text</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/bbox.html" class="external-link">bbox</a></span><span class="op">(</span><span class="va">Syracuse</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span>, labels<span class="op">=</span><span class="st">"c)"</span>, cex<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">oopar</span><span class="op">)</span></span></code></pre></div>
<p>a: Neighbours within 1,158m; b: neighbours within 1,545m; c:
neighbours within 2,317m</p>
<p>The figure shows how the numbers of distance-based neighbours
increase with moderate increases in distance. Moving from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.75</mn><annotation encoding="application/x-tex">0.75</annotation></semantics></math>
times the minimum all-included distance, to the all-included distance,
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1.5</mn><annotation encoding="application/x-tex">1.5</annotation></semantics></math>
times the minimum all-included distance, the numbers of links grow
rapidly. This is a major problem when some of the first nearest
neighbour distances in a study area are much larger than others, since
to avoid no-neighbour areal entities, the distance criterion will need
to be set such that many areas have many neighbours.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.75</span>, <span class="fl">1</span>, <span class="fl">1.5</span><span class="op">)</span><span class="op">*</span><span class="va">max_1nn</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">nb_l</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="va">Sy13_nb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="op">(</span><span class="va">mx</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, nrow<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">mx</span><span class="op">)</span></span>
<span><span class="va">res1</span><span class="op">[</span><span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">d1</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">d1</span></span>
<span><span class="va">res1</span><span class="op">[</span><span class="fl">2</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">d2</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">d2</span></span>
<span><span class="va">res1</span><span class="op">[</span><span class="fl">3</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">d3</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">$</span><span class="va">d3</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="va">pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.colors.html" class="external-link">grey.colors</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">0.95</span>, <span class="fl">0.55</span>, <span class="fl">2.2</span><span class="op">)</span></span>
<span><span class="co"># RSB quietening greys</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="va">res1</span>, col<span class="op">=</span><span class="va">pal</span>, beside<span class="op">=</span><span class="cn">TRUE</span>, legend.text<span class="op">=</span><span class="cn">FALSE</span>, xlab<span class="op">=</span><span class="st">"numbers of neighbours"</span>, ylab<span class="op">=</span><span class="st">"tracts"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">dS</span>, digits<span class="op">=</span><span class="fl">1</span><span class="op">)</span>, fill<span class="op">=</span><span class="va">pal</span>, bty<span class="op">=</span><span class="st">"n"</span>, cex<span class="op">=</span><span class="fl">0.8</span>, title<span class="op">=</span><span class="st">"max. distance"</span><span class="op">)</span></span></code></pre></div>
<p><img src="nb_files/figure-html/unnamed-chunk-15-1.png" width="700">
Distance-based neighbours: frequencies of numbers of neighbours by
census tract</p>
<p>The figure shows the counts of sizes of sets of neighbours for the
three different distance limits. In Syracuse, the census tracts are of
similar areas, but were we to try to use the distance-based neighbour
criterion on the eight-county study area, the smallest distance securing
at least one neighbour for every areal entity is over 38km.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsts0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="../reference/nbdists.html">nbdists</a></span><span class="op">(</span><span class="va">NY_nb</span>, <span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">NY8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dsts0</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">##    82.7  1505.0  3378.7  5865.8  8954.3 38438.1</span></span></code></pre>
<p>If the areal entities are approximately regularly spaced, using
distance-based neighbours is not necessarily a problem. Provided that
care is taken to handle the side effects of “weighting” areas out of the
analysis, using lists of neighbours with no-neighbour areas is not
necessarily a problem either, but certainly ought to raise questions.
Different disciplines handle the definition of neighbours in their own
ways by convention; in particular, it seems that ecologists frequently
use distance bands. If many distance bands are used, they approach the
variogram, although the underlying understanding of spatial
autocorrelation seems to be by contagion rather than continuous.</p>
</div>
<div class="section level3">
<h3 id="higher-order-neighbours">Higher-Order Neighbours<a class="anchor" aria-label="anchor" href="#higher-order-neighbours"></a>
</h3>
<p>Distance bands can be generated by using a sequence of
<code>d1</code> and <code>d2</code> argument values for the
<code><a href="../reference/dnearneigh.html">dnearneigh()</a></code> function if needed to construct a spatial
autocorrelogram as understood in ecology. In other conventions,
correlograms are constructed by taking an input list of neighbours as
the first-order sets, and stepping out across the graph to second-,
third-, and higher-order neighbours based on the number of links
traversed, but not permitting cycles, which could risk making
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
a neighbour of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
itself <span class="citation">(O’Sullivan and Unwin 2003)</span>. The
<code><a href="../reference/nblag.html">nblag()</a></code> function takes an existing neighbour list and
returns a list of lists, from first to <code>maxlag=</code> order
neighbours.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Sy0_nb_lags</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nblag.html">nblag</a></span><span class="op">(</span><span class="va">Sy0_nb</span>, maxlag<span class="op">=</span><span class="fl">9</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in nblag(Sy0_nb, maxlag = 9): lag 6 neighbour object has 7 sub-graphs</span></span></code></pre>
<pre><code><span><span class="co">## Warning in nblag(Sy0_nb, maxlag = 9): lag 7 neighbour object has 22 sub-graphs</span></span></code></pre>
<pre><code><span><span class="co">## Warning in nblag(Sy0_nb, maxlag = 9): lag 8 neighbour object has 52 sub-graphs</span></span></code></pre>
<pre><code><span><span class="co">## Warning in nblag(Sy0_nb, maxlag = 9): lag 9 neighbour object has 63 sub-graphs</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">Sy0_nb_lags</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"first"</span>, <span class="st">"second"</span>, <span class="st">"third"</span>, <span class="st">"fourth"</span>, <span class="st">"fifth"</span>, <span class="st">"sixth"</span>, <span class="st">"seventh"</span>, <span class="st">"eighth"</span>, <span class="st">"ninth"</span><span class="op">)</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Sy0_nb_lags</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">Sy0_nb_lags</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Sy0_nb_lags</span><span class="op">)</span></span>
<span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, ncol<span class="op">=</span><span class="op">(</span><span class="va">mx</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>, nrow<span class="op">=</span><span class="va">nn</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">res1</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="va">mx</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nn</span><span class="op">)</span> <span class="va">res1</span><span class="op">[</span><span class="va">i</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">res1</span></span></code></pre></div>
<pre><code><span><span class="co">##          0 1 2 3 4  5  6 7 8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24</span></span>
<span><span class="co">## first    0 1 1 5 9 14 17 9 6  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</span></span>
<span><span class="co">## second   0 0 0 0 2  2  0 6 6 11 11  4  3  7  4  6  1  0  0  0  0  0  0  0  0</span></span>
<span><span class="co">## third    0 0 0 0 0  0  0 1 3  5  5  7 14  6  8  3  3  0  1  1  1  3  1  0  1</span></span>
<span><span class="co">## fourth   0 0 0 0 0  0  0 0 1  3  5  7 16 16  5  3  3  2  0  1  1  0  0  0  0</span></span>
<span><span class="co">## fifth    0 0 0 1 1  3  1 1 3  7 13 12  8  9  3  1  0  0  0  0  0  0  0  0  0</span></span>
<span><span class="co">## sixth    6 3 0 2 8  2  5 5 4  8  9  5  5  1  0  0  0  0  0  0  0  0  0  0  0</span></span>
<span><span class="co">## seventh 21 7 4 5 9  7  3 5 1  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0  0</span></span>
<span><span class="co">## eighth  49 6 5 2 1  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</span></span>
<span><span class="co">## ninth   63 0 0 0 0  0  0 0 0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0</span></span></code></pre>
<p>This shows how the wave of connectedness in the graph spreads to the
third order, receding to the eighth order, and dying away at the ninth
order - there are no tracts nine steps from each other in this graph.
Both the distance bands and the graph step order approaches to spreading
neighbourhoods can be used to examine the shape of relationship
intensities in space, like the variogram, and can be used in attempting
to look at the effects of scale.</p>
</div>
<div class="section level3">
<h3 id="grid-neighbours">Grid Neighbours<a class="anchor" aria-label="anchor" href="#grid-neighbours"></a>
</h3>
<p>When the data are known to be arranged in a regular, rectangular
grid, the <code><a href="../reference/cell2nb.html">cell2nb()</a></code> function can be used to construct
neighbour lists, including those on a torus. These are useful for
simulations, because, since all areal entities have equal numbers of
neighbours, and there are no edges, the structure of the graph is as
neutral as can be achieved. Neighbours can either be of type rook or
queen.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cell2nb.html">cell2nb</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">7</span>, type<span class="op">=</span><span class="st">"rook"</span>, torus<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 49 </span></span>
<span><span class="co">## Number of nonzero links: 196 </span></span>
<span><span class="co">## Percentage nonzero weights: 8.163265 </span></span>
<span><span class="co">## Average number of links: 4</span></span></code></pre>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/cell2nb.html">cell2nb</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">7</span>, type<span class="op">=</span><span class="st">"rook"</span>, torus<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 49 </span></span>
<span><span class="co">## Number of nonzero links: 168 </span></span>
<span><span class="co">## Percentage nonzero weights: 6.997085 </span></span>
<span><span class="co">## Average number of links: 3.428571</span></span></code></pre>
<p>When a regular, rectangular grid is not complete, then we can use
knowledge of the cell size stored in the grid topology to create an
appropriate list of neighbours, using a tightly bounded distance
criterion. Neighbour lists of this kind are commonly found in ecological
assays, such as studies of species richness at a national or continental
scale. It is also in these settings, with moderately large
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>,
here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">n=3</annotation></semantics></math>,103,
that the use of a sparse, list based representation shows its strength.
Handling a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>281</mn><mo>×</mo><mn>281</mn></mrow><annotation encoding="application/x-tex">281 \times 281</annotation></semantics></math>
matrix for the eight-county census tracts is feasible, easy for a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>63</mn><mo>×</mo><mn>63</mn></mrow><annotation encoding="application/x-tex">63 \times 63</annotation></semantics></math>
matrix for Syracuse census tracts, but demanding for a
3,<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>103</mn><mo>×</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">103 \times 3</annotation></semantics></math>,103
matrix.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://edzer.github.io/sp/reference/gridded-methods.html" class="external-link">gridded</a></span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span><span class="va">dst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/methods/slot.html" class="external-link">slot</a></span><span class="op">(</span><span class="va">meuse.grid</span>, <span class="st">"grid"</span><span class="op">)</span>, <span class="st">"cellsize"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mg_nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dnearneigh.html">dnearneigh</a></span><span class="op">(</span><span class="fu"><a href="https://edzer.github.io/sp/reference/coordinates.html" class="external-link">coordinates</a></span><span class="op">(</span><span class="va">meuse.grid</span><span class="op">)</span>, <span class="fl">0</span>, <span class="va">dst</span><span class="op">)</span></span>
<span><span class="va">mg_nb</span></span></code></pre></div>
<pre><code><span><span class="co">## Neighbour list object:</span></span>
<span><span class="co">## Number of regions: 3103 </span></span>
<span><span class="co">## Number of nonzero links: 12022 </span></span>
<span><span class="co">## Percentage nonzero weights: 0.1248571 </span></span>
<span><span class="co">## Average number of links: 3.874315</span></span></code></pre>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="fu"><a href="../reference/card.html">card</a></span><span class="op">(</span><span class="va">mg_nb</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##    1    2    3    4 </span></span>
<span><span class="co">##    1  133  121 2848</span></span></code></pre>
</div>
<div class="section level3">
<h3 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-avis+horton:1985" class="csl-entry">
Avis, D., and J. Horton. 1985. <span>“Remarks on the Sphere of Influence
Graph.”</span> In <em>Discrete Geometry and Convexity</em>, edited by J.
E. Goodman, 323–27. New York: New York Academy of Sciences, New York.
</div>
<div id="ref-matula+sokal:80" class="csl-entry">
Matula, D. W., and R. R. Sokal. 1980. <span>“Properties of
<span>G</span>abriel Graphs Relevant to Geographic Variation Research
and the Clustering of Points in the Plane.”</span> <em>Geographical
Analysis</em> 12: 205–22.
</div>
<div id="ref-osullivan+unwin:03" class="csl-entry">
O’Sullivan, D., and D. J. Unwin. 2003. <em>Geographical Information
Analysis</em>. Hoboken, NJ: Wiley.
</div>
<div id="ref-toussaint:80" class="csl-entry">
Toussaint, G. T. 1980. <span>“The Relative Neighborhood Graph of a
Finite Planar Set.”</span> <em>Pattern Recognition</em> 12: 261–68.
</div>
<div id="ref-WallerGotway:2004" class="csl-entry">
Waller, L. A., and C. A. Gotway. 2004. <em>Applied Spatial Statistics
for Public Health Data</em>. Hoboken, NJ: John Wiley &amp; Sons.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Roger Bivand.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
